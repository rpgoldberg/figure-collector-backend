
> figure-collector-backend@1.0.0 test
> NODE_OPTIONS=--experimental-vm-modules npx jest --passWithNoTests --verbose --bail=false --runInBand --verbose --json

  console.log
    Bulk inserted 100 figures in 73ms

      at Object.<anonymous> (tests/performance/stress.test.ts:53:15)

  console.log
    Complex aggregation completed in 7ms

      at Object.<anonymous> (tests/performance/stress.test.ts:118:15)

  console.log
    50 concurrent operations completed in 91ms

      at Object.<anonymous> (tests/performance/stress.test.ts:150:15)

  console.log
    GET /figures with pagination responded in 36ms

      at Object.<anonymous> (tests/performance/stress.test.ts:184:15)

  console.log
    20 concurrent GET requests completed in 177ms

      at Object.<anonymous> (tests/performance/stress.test.ts:209:15)

  console.log
    20 rapid POST requests completed in 113ms

      at Object.<anonymous> (tests/performance/stress.test.ts:241:15)

  console.log
    Stats calculation responded in 9ms

      at Object.<anonymous> (tests/performance/stress.test.ts:274:15)

  console.log
    50 authentication cycles completed in 243ms

      at Object.<anonymous> (tests/performance/stress.test.ts:325:15)

  console.log
    30 invalid requests handled in 74ms

      at Object.<anonymous> (tests/performance/stress.test.ts:371:15)

  console.log
    40 mixed valid/invalid requests handled in 184ms

      at Object.<anonymous> (tests/performance/stress.test.ts:427:15)

  console.log
    Response time for 10 figures: 6ms

      at Object.<anonymous> (tests/performance/stress.test.ts:469:17)

  console.log
    Response time for 50 figures: 7ms

      at Object.<anonymous> (tests/performance/stress.test.ts:469:17)

  console.log
    Response time for 100 figures: 6ms

      at Object.<anonymous> (tests/performance/stress.test.ts:469:17)

FAIL tests/performance/stress.test.ts
  Performance and Stress Tests
    Database Performance Tests
      ✓ should handle bulk figure creation efficiently (174 ms)
      ✓ should handle complex aggregation queries efficiently (162 ms)
      ✓ should handle concurrent database operations (150 ms)
    API Endpoint Performance Tests
      ✓ should handle GET /figures with pagination efficiently (110 ms)
      ✓ should handle multiple concurrent GET requests (249 ms)
      ✓ should handle rapid POST requests efficiently (186 ms)
      ✕ should handle filter queries efficiently (79 ms)
      ✓ should handle stats calculation efficiently (84 ms)
    Memory and Resource Usage Tests
      ✓ should handle large JSON payloads without memory issues (57 ms)
      ✓ should handle rapid authentication cycles (312 ms)
    Error Handling Under Load
      ✓ should handle concurrent invalid requests gracefully (139 ms)
      ✓ should maintain performance under mixed valid/invalid load (238 ms)
    Scalability Tests
      ✓ should maintain response times as data grows (135 ms)

  ● Performance and Stress Tests › API Endpoint Performance Tests › should handle filter queries efficiently

    expected 200 "OK", got 422 "Unprocessable Entity"

      248 |         .get('/figures/filter?manufacturer=API Manufacturer 0&scale=1/8')
      249 |         .set('Authorization', `Bearer ${authToken}`)
    > 250 |         .expect(200);
          |          ^
      251 |
      252 |       const responseTime = Date.now() - startTime;
      253 |

      at Object.<anonymous> (tests/performance/stress.test.ts:250:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  console.log
    [MFC ENDPOINT] Received scrape request

      at scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: {
      host: '127.0.0.1:36269',
      'accept-encoding': 'gzip, deflate',
      'content-type': 'application/json',
      'content-length': '55',
      connection: 'close'
    }

      at scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.log
    [MFC MAIN] Scraper service successful: {
      manufacturer: 'Good Smile Company',
      name: 'Hatsune Miku',
      scale: '1/8',
      imageUrl: 'https://example.com/image.jpg'
    }

      at scrapeDataFromMFC (src/controllers/figureController.ts:152:15)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {
      manufacturer: 'Good Smile Company',
      name: 'Hatsune Miku',
      scale: '1/8',
      imageUrl: 'https://example.com/image.jpg'
    }

      at scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://example.com/item/12345' }

      at scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: {
      host: '127.0.0.1:44561',
      'accept-encoding': 'gzip, deflate',
      'content-type': 'application/json',
      'content-length': '44',
      connection: 'close'
    }

      at scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://example.com/item/12345

      at scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] URL is not from myfigurecollection.net

      at scrapeMFCData (src/controllers/figureController.ts:217:15)

  console.log
    [MFC ENDPOINT] Received scrape request

      at scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: {}

      at scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: {
      host: '127.0.0.1:40539',
      'accept-encoding': 'gzip, deflate',
      'content-type': 'application/json',
      'content-length': '2',
      connection: 'close'
    }

      at scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] No MFC link provided in request

      at scrapeMFCData (src/controllers/figureController.ts:194:15)

FAIL tests/integration/figureRoutes.test.ts
  Figure Routes Integration
    POST /figures/scrape-mfc
      ✓ should scrape MFC data successfully (public endpoint) (159 ms)
      ✓ should return error for invalid MFC URL (64 ms)
      ✓ should return error for missing MFC link (58 ms)
    GET /figures
      ✓ should get user figures with authentication (73 ms)
      ✓ should support pagination (63 ms)
      ✕ should handle advanced pagination scenarios (87 ms)
      ✕ should handle pagination edge cases (60 ms)
      ✓ should return 401 without authentication (58 ms)
      ✓ should only return figures belonging to authenticated user (112 ms)
    POST /figures
      ✓ should create figure successfully without scraping (61 ms)
      ✕ should create figure with MFC scraping (56 ms)
      ✓ should return 401 without authentication (57 ms)
      ✕ should handle comprehensive figure creation validation (56 ms)
      ✕ should prevent duplicate figure creation (58 ms)
    GET /figures/:id
      ✓ should get figure by id successfully (59 ms)
      ✓ should return 404 for non-existent figure (59 ms)
      ✓ should return 404 for figure belonging to another user (110 ms)
    PUT /figures/:id
      ✓ should update figure successfully (67 ms)
      ✕ should return 404 for non-existent figure (61 ms)
    DELETE /figures/:id
      ✓ should delete figure successfully (62 ms)
      ✓ should return 404 for non-existent figure (58 ms)
    GET /figures/search
      ✓ should return error when query parameter is missing (60 ms)
      ✕ should handle search query with Atlas Search mocking (60 ms)
      ✕ should handle complex Atlas Search scenarios (61 ms)
      ✕ should handle case-insensitive and partial Atlas Search (57 ms)
    GET /figures/filter
      ✕ should filter figures by manufacturer (58 ms)
      ✕ should filter figures by scale (59 ms)
      ✕ should filter figures by location (58 ms)
      ✕ should combine multiple filters (60 ms)
      ✕ should handle advanced filtering scenarios (59 ms)
      ✕ should handle filtering with no matching results (58 ms)
    GET /figures/stats
      ✓ should return figure statistics (63 ms)
      ✓ should return 401 without authentication (58 ms)

  ● Figure Routes Integration › GET /figures › should handle advanced pagination scenarios

    expect(received).toBe(expected) // Object.is equality

    Expected: 4
    Received: 3

      184 |           .expect(200);
      185 |
    > 186 |         expect(response.body.count).toBe(scenario.expectedCount);
          |                                     ^
      187 |         expect(response.body.page).toBe(scenario.page);
      188 |         expect(response.body.pages).toBe(scenario.expectedPages);
      189 |         expect(response.body.data).toHaveLength(scenario.expectedCount);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:186:37)

  ● Figure Routes Integration › GET /figures › should handle pagination edge cases

    expected 400 "Bad Request", got 422 "Unprocessable Entity"

      204 |           .get(`/figures?page=${scenario.page}&limit=${scenario.limit}`)
      205 |           .set('Authorization', `Bearer ${authToken}`)
    > 206 |           .expect(scenario.expectedStatus);
          |            ^
      207 |
      208 |         if (scenario.expectedStatus === 400) {
      209 |           expect(response.body.success).toBe(false);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:206:12)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › POST /figures › should create figure with MFC scraping

    expected 201 "Created", got 422 "Unprocessable Entity"

      312 |         .set('Authorization', `Bearer ${authToken}`)
      313 |         .send(figureData)
    > 314 |         .expect(201);
          |          ^
      315 |
      316 |       expect(response.body.data.manufacturer).toBe('Good Smile Company');
      317 |       expect(response.body.data.name).toBe('Hatsune Miku');

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:314:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › POST /figures › should handle comprehensive figure creation validation

    expect(received).toMatch(expected)

    Expected pattern: /validation failed/i
    Received string:  "Validation Error"

      384 |
      385 |         expect(response.body.success).toBe(false);
    > 386 |         expect(response.body.message).toMatch(scenario.expectedMessage);
          |                                       ^
      387 |       }
      388 |     });
      389 |

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:386:39)

  ● Figure Routes Integration › POST /figures › should prevent duplicate figure creation

    expected 201 "Created", got 422 "Unprocessable Entity"

      400 |         .set('Authorization', `Bearer ${authToken}`)
      401 |         .send(duplicateFigureData)
    > 402 |         .expect(201);
          |          ^
      403 |
      404 |       // Second creation with same unique identifier should fail
      405 |       const secondResponse = await request(app)

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:402:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › PUT /figures/:id › should return 404 for non-existent figure

    expected 404 "Not Found", got 422 "Unprocessable Entity"

      532 |         .set('Authorization', `Bearer ${authToken}`)
      533 |         .send({ name: 'Updated' })
    > 534 |         .expect(404);
          |          ^
      535 |
      536 |       expect(response.body).toEqual({
      537 |         success: false,

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:534:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/search › should handle search query with Atlas Search mocking

    expected 200 "OK", got 422 "Unprocessable Entity"

      620 |         .get('/figures/search?query=Miku')
      621 |         .set('Authorization', `Bearer ${authToken}`)
    > 622 |         .expect(200);
          |          ^
      623 |
      624 |       expect(response.body.success).toBe(true);
      625 |       expect(response.body.data).toHaveLength(1);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:622:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/search › should handle complex Atlas Search scenarios

    expected 200 "OK", got 422 "Unprocessable Entity"

      661 |           .get(`/figures/search?query=${encodeURIComponent(scenario.query)}`)
      662 |           .set('Authorization', `Bearer ${authToken}`)
    > 663 |           .expect(200);
          |            ^
      664 |
      665 |         expect(response.body.success).toBe(true);
      666 |         expect(response.body.data).toHaveLength(scenario.expectedLength);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:663:12)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/search › should handle case-insensitive and partial Atlas Search

    expected 200 "OK", got 422 "Unprocessable Entity"

      680 |           .get(`/figures/search?query=${encodeURIComponent(searchQuery.query)}`)
      681 |           .set('Authorization', `Bearer ${authToken}`)
    > 682 |           .expect(200);
          |            ^
      683 |
      684 |         expect(response.body.success).toBe(true);
      685 |         expect(response.body.data).toHaveLength(searchQuery.expectedLength);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:682:12)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/filter › should filter figures by manufacturer

    expected 200 "OK", got 422 "Unprocessable Entity"

      721 |         .get('/figures/filter?manufacturer=Good Smile Company')
      722 |         .set('Authorization', `Bearer ${authToken}`)
    > 723 |         .expect(200);
          |          ^
      724 |
      725 |       expect(response.body.success).toBe(true);
      726 |       expect(response.body.total).toBe(2);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:723:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/filter › should filter figures by scale

    expected 200 "OK", got 422 "Unprocessable Entity"

      734 |         .get('/figures/filter?scale=1/8')
      735 |         .set('Authorization', `Bearer ${authToken}`)
    > 736 |         .expect(200);
          |          ^
      737 |
      738 |       expect(response.body.success).toBe(true);
      739 |       expect(response.body.total).toBe(2);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:736:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/filter › should filter figures by location

    expected 200 "OK", got 422 "Unprocessable Entity"

      745 |         .get('/figures/filter?location=Shelf A')
      746 |         .set('Authorization', `Bearer ${authToken}`)
    > 747 |         .expect(200);
          |          ^
      748 |
      749 |       expect(response.body.success).toBe(true);
      750 |       expect(response.body.total).toBe(2);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:747:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/filter › should combine multiple filters

    expected 200 "OK", got 422 "Unprocessable Entity"

      758 |         .get('/figures/filter?manufacturer=Good Smile Company&scale=1/8')
      759 |         .set('Authorization', `Bearer ${authToken}`)
    > 760 |         .expect(200);
          |          ^
      761 |
      762 |       expect(response.body.success).toBe(true);
      763 |       expect(response.body.total).toBe(2);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:760:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/filter › should handle advanced filtering scenarios

    expected 200 "OK", got 422 "Unprocessable Entity"

      807 |           .get(scenario.query)
      808 |           .set('Authorization', `Bearer ${authToken}`)
    > 809 |           .expect(200);
          |            ^
      810 |
      811 |         expect(response.body.success).toBe(true);
      812 |         expect(response.body.total).toBe(scenario.expectedTotal);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:809:12)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Figure Routes Integration › GET /figures/filter › should handle filtering with no matching results

    expected 200 "OK", got 422 "Unprocessable Entity"

      832 |           .get(query)
      833 |           .set('Authorization', `Bearer ${authToken}`)
    > 834 |           .expect(200);
          |            ^
      835 |
      836 |         expect(response.body.success).toBe(true);
      837 |         expect(response.body.total).toBe(0);

      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:834:12)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

FAIL tests/integration/routeValidation.test.ts
  Route Validation and Error Handling
    Figure Routes Parameter Validation
      GET /figures/:id
        ✓ should return 422 for invalid ObjectId format (168 ms)
        ✓ should handle very long invalid IDs gracefully (62 ms)
        ✓ should handle special characters in ID parameter (56 ms)
      PUT /figures/:id
        ✓ should return 422 for invalid ObjectId in update (59 ms)
      DELETE /figures/:id
        ✓ should return 422 for invalid ObjectId in delete (56 ms)
    Request Body Validation
      POST /figures
        ✓ should handle malformed JSON gracefully (58 ms)
        ✓ should handle extremely long field values (59 ms)
        ✓ should handle null values in optional fields (55 ms)
        ✓ should handle nested object attacks (58 ms)
      POST /users/register
        ✓ should handle missing required fields gracefully (56 ms)
        ✓ should handle extremely long username (58 ms)
        ✓ should handle invalid email formats (71 ms)
        ✓ should handle SQL injection attempts in fields (55 ms)
    Query Parameter Validation
      GET /figures with pagination
        ✕ should handle invalid page numbers with validation error (77 ms)
        ✓ should handle invalid limit values with validation error (74 ms)
        ✓ should handle both invalid page and limit with validation error (58 ms)
      GET /figures/search
        ✕ should handle empty search query (61 ms)
        ✕ should handle special characters in search query (60 ms)
        ✕ should handle extremely long search queries (59 ms)
      GET /figures/filter
        ✕ should handle regex injection attempts (61 ms)
        ✕ should handle URL encoded parameters (61 ms)
    Content-Type Handling
      ✓ should handle unsupported content types (57 ms)
      ✓ should handle XML content type (56 ms)
    Header Validation
      ✓ should handle missing Authorization header (56 ms)
      ✓ should handle malformed Authorization header (69 ms)
      ✓ should handle extremely long Authorization header (55 ms)
    Rate Limiting and Large Payloads
      ✓ should handle large JSON payloads (55 ms)
    Error Response Consistency
      ✓ should return consistent error format across endpoints (69 ms)

  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures with pagination › should handle invalid page numbers with validation error

    expected 422 "Unprocessable Entity", got 200 "OK"

      287 |             .get(`/figures?page=${page}`)
      288 |             .set('Authorization', `Bearer ${authToken}`)
    > 289 |             .expect(422);
          |              ^
      290 |           
      291 |           expect(response.body.success).toBe(false);
      292 |           expect(response.body.message).toBe('Validation Error');

      at Object.<anonymous> (tests/integration/routeValidation.test.ts:289:14)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/search › should handle empty search query

    expected 400 "Bad Request", got 422 "Unprocessable Entity"

      327 |           .get('/figures/search?query=')
      328 |           .set('Authorization', `Bearer ${authToken}`)
    > 329 |           .expect(400);
          |            ^
      330 |
      331 |         expect(response.body.success).toBe(false);
      332 |         expect(response.body.message).toBe('Search query is required');

      at Object.<anonymous> (tests/integration/routeValidation.test.ts:329:12)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/search › should handle special characters in search query

    expect(received).toContain(expected) // indexOf

    Expected value: 422
    Received array: [200, 500]

      341 |
      342 |         // Should handle gracefully (may succeed or fail based on Atlas Search availability)
    > 343 |         expect([200, 500]).toContain(response.status);
          |                            ^
      344 |       });
      345 |
      346 |       it('should handle extremely long search queries', async () => {

      at Object.<anonymous> (tests/integration/routeValidation.test.ts:343:28)

  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/search › should handle extremely long search queries

    expect(received).toContain(expected) // indexOf

    Expected value: 422
    Received array: [200, 400, 500]

      351 |           .set('Authorization', `Bearer ${authToken}`);
      352 |
    > 353 |         expect([200, 400, 500]).toContain(response.status);
          |                                 ^
      354 |       });
      355 |     });
      356 |

      at Object.<anonymous> (tests/integration/routeValidation.test.ts:353:33)

  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/filter › should handle regex injection attempts

    expected 200 "OK", got 422 "Unprocessable Entity"

      368 |             .get(`/figures/filter?${filter}`)
      369 |             .set('Authorization', `Bearer ${authToken}`)
    > 370 |             .expect(200);
          |              ^
      371 |
      372 |           expect(response.body.success).toBe(true);
      373 |           // Should handle regex patterns safely

      at Object.<anonymous> (tests/integration/routeValidation.test.ts:370:14)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/filter › should handle URL encoded parameters

    expected 200 "OK", got 422 "Unprocessable Entity"

      381 |           .get(`/figures/filter?manufacturer=${encodedManufacturer}`)
      382 |           .set('Authorization', `Bearer ${authToken}`)
    > 383 |           .expect(200);
          |            ^
      384 |
      385 |         expect(response.body.success).toBe(true);
      386 |       });

      at Object.<anonymous> (tests/integration/routeValidation.test.ts:383:12)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

FAIL tests/integration/userRoutes.test.ts
  User Routes Integration
    POST /users/register
      ✓ should register a new user successfully (140 ms)
      ✕ should return error for missing required fields (15 ms)
      ✓ should return error for duplicate username (64 ms)
      ✓ should return error for duplicate email (65 ms)
      ✕ should handle invalid email format (9 ms)
    POST /users/login
      ✕ should login successfully with correct credentials (55 ms)
      ✕ should return error for incorrect email (56 ms)
      ✕ should return error for incorrect password (58 ms)
      ✕ should return error for missing credentials (56 ms)
      ✕ should login admin user successfully (102 ms)
    GET /users/profile
      ✓ should get user profile with valid token (60 ms)
      ✓ should return 401 without token (58 ms)
      ✓ should return 401 with invalid token (55 ms)
      ✓ should return 404 if user no longer exists (60 ms)
    PUT /users/profile
      ✓ should update user profile successfully (63 ms)
      ✕ should update password successfully (57 ms)
      ✕ should update only provided fields (58 ms)
      ✓ should return 401 without token (56 ms)
      ✕ should return 404 if user no longer exists (57 ms)
    Authentication Flow Integration
      ✕ should complete full registration and login flow (64 ms)

  ● User Routes Integration › POST /users/register › should return error for missing required fields

    expected 500 "Internal Server Error", got 422 "Unprocessable Entity"

      49 |         .post('/users/register')
      50 |         .send(incompleteData)
    > 51 |         .expect(500);
         |          ^
      52 |
      53 |       expect(response.body.success).toBe(false);
      54 |       expect(response.body.message).toBe('Server Error');

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:51:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › POST /users/register › should handle invalid email format

    expected 500 "Internal Server Error", got 422 "Unprocessable Entity"

      127 |         .post('/users/register')
      128 |         .send(userData)
    > 129 |         .expect(500);
          |          ^
      130 |
      131 |       expect(response.body.success).toBe(false);
      132 |     });

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:129:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › POST /users/login › should login successfully with correct credentials

    expected 200 "OK", got 422 "Unprocessable Entity"

      155 |         .post('/users/login')
      156 |         .send(loginData)
    > 157 |         .expect(200);
          |          ^
      158 |
      159 |       expect(response.body).toEqual({
      160 |         success: true,

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:157:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › POST /users/login › should return error for incorrect email

    expected 401 "Unauthorized", got 422 "Unprocessable Entity"

      178 |         .post('/users/login')
      179 |         .send(loginData)
    > 180 |         .expect(401);
          |          ^
      181 |
      182 |       expect(response.body).toEqual({
      183 |         success: false,

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:180:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › POST /users/login › should return error for incorrect password

    expected 401 "Unauthorized", got 422 "Unprocessable Entity"

      195 |         .post('/users/login')
      196 |         .send(loginData)
    > 197 |         .expect(401);
          |          ^
      198 |
      199 |       expect(response.body).toEqual({
      200 |         success: false,

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:197:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › POST /users/login › should return error for missing credentials

    expected 401 "Unauthorized", got 422 "Unprocessable Entity"

      207 |         .post('/users/login')
      208 |         .send({})
    > 209 |         .expect(401);
          |          ^
      210 |
      211 |       expect(response.body.success).toBe(false);
      212 |     });

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:209:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › POST /users/login › should login admin user successfully

    expected 200 "OK", got 422 "Unprocessable Entity"

      229 |         .post('/users/login')
      230 |         .send(loginData)
    > 231 |         .expect(200);
          |          ^
      232 |
      233 |       expect(response.body.data.isAdmin).toBe(true);
      234 |     });

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:231:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › PUT /users/profile › should update password successfully

    expected 200 "OK", got 422 "Unprocessable Entity"

      359 |         .set('Authorization', `Bearer ${authToken}`)
      360 |         .send(updateData)
    > 361 |         .expect(200);
          |          ^
      362 |
      363 |       expect(response.body.success).toBe(true);
      364 |

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:361:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › PUT /users/profile › should update only provided fields

    expected 200 "OK", got 422 "Unprocessable Entity"

      383 |         .set('Authorization', `Bearer ${authToken}`)
      384 |         .send(updateData)
    > 385 |         .expect(200);
          |          ^
      386 |
      387 |       expect(response.body.data.username).toBe(originalUsername);
      388 |       expect(response.body.data.email).toBe('newemail@example.com');

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:385:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › PUT /users/profile › should return 404 if user no longer exists

    expected 404 "Not Found", got 422 "Unprocessable Entity"

      417 |         .set('Authorization', `Bearer ${authToken}`)
      418 |         .send(updateData)
    > 419 |         .expect(404);
          |          ^
      420 |
      421 |       expect(response.body).toEqual({
      422 |         success: false,

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:419:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● User Routes Integration › Authentication Flow Integration › should complete full registration and login flow

    expected 200 "OK", got 422 "Unprocessable Entity"

      453 |         .post('/users/login')
      454 |         .send(loginData)
    > 455 |         .expect(200);
          |          ^
      456 |
      457 |       expect(loginResponse.body.success).toBe(true);
      458 |       expect(loginResponse.body.data._id).toBe(userId);

      at Object.<anonymous> (tests/integration/userRoutes.test.ts:455:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

FAIL tests/integration/atlasSearch.test.ts
  Atlas Search Integration Tests
    Atlas Search Mock Functionality
      ✕ should test mock Atlas Search function directly (181 ms)
      ✕ should perform search via API endpoint with mocked Atlas Search (61 ms)
      ✕ should ensure user isolation in search results (116 ms)
      ✕ should handle empty search results (60 ms)
      ✓ should validate search query parameter (61 ms)
      ✓ should require authentication for search (59 ms)

  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should test mock Atlas Search function directly

    TypeError: (0 , setup_1.mockAtlasSearch) is not a function

      67 |       
      68 |       // Test exact match
    > 69 |       let results = mockAtlasSearch('Miku', allFigures, testUser._id);
         |                                    ^
      70 |       expect(results).toHaveLength(1);
      71 |       expect(results[0].name).toBe('Hatsune Miku');
      72 |       

      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:69:36)

  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should perform search via API endpoint with mocked Atlas Search

    TypeError: (0 , setup_1.getTestMode) is not a function

      93 |
      94 |     it('should perform search via API endpoint with mocked Atlas Search', async () => {
    > 95 |       const testMode = getTestMode();
         |                                   ^
      96 |       const usingRealAtlas = isUsingRealAtlasSearch();
      97 |       console.log('Running test in ' + testMode + ' mode, using real Atlas: ' + usingRealAtlas);
      98 |       

      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:95:35)

  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should ensure user isolation in search results

    expected 200 "OK", got 422 "Unprocessable Entity"

      141 |         .get('/figures/search?query=Good Smile Company')
      142 |         .set('Authorization', 'Bearer ' + authToken)
    > 143 |         .expect(200);
          |          ^
      144 |
      145 |       expect(response.body.success).toBe(true);
      146 |       expect(response.body.data).toHaveLength(2); // Only original user's figures

      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:143:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should handle empty search results

    expected 200 "OK", got 422 "Unprocessable Entity"

      154 |         .get('/figures/search?query=NonexistentTerm')
      155 |         .set('Authorization', 'Bearer ' + authToken)
    > 156 |         .expect(200);
          |          ^
      157 |
      158 |       expect(response.body.success).toBe(true);
      159 |       expect(response.body.data).toHaveLength(0);

      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:156:10)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)
      at node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)
      at Test.assert (node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)

FAIL tests/integration/serviceEndpoints.test.ts
  Service Endpoints Integration
    GET /health
      ✓ should return health check status (26 ms)
    POST /register-service
      ✓ should register frontend service successfully (112 ms)
      ✓ should register frontend service with minimal data (11 ms)
      ✓ should return error for missing serviceName (6 ms)
      ✓ should return error for missing version (6 ms)
      ✓ should return error for unsupported service (6 ms)
      ✓ should handle empty request body (6 ms)
      ✓ should handle malformed JSON (6 ms)
      Service name handling
        ✓ should use provided service name (9 ms)
        ✓ should use default name if not provided (11 ms)
    GET /version
      ✕ should return version information with default values (9 ms)
      ✓ should reflect registered frontend service (11 ms)
      ✓ should maintain service state across multiple requests (15 ms)
      ✓ should handle version updates (15 ms)
      Version format validation
        ✓ should handle semantic versions (25 ms)
        ✓ should handle non-semantic versions (27 ms)
        ✕ should handle empty version string (9 ms)
    Service Registration and Version Flow
      ✕ should complete full service registration flow (7 ms)
      ✓ should handle multiple rapid registrations (23 ms)
    Error Handling
      ✓ should handle version endpoint errors gracefully (6 ms)
      ✓ should handle service registration errors gracefully (15 ms)
    Content-Type Handling
      ✓ should handle application/json content type (7 ms)
      ✓ should handle form-encoded data (7 ms)
      ✓ should handle missing content-type (7 ms)

  ● Service Endpoints Integration › GET /version › should return version information with default values

    expect(received).toEqual(expected) // deep equality

    - Expected  - 2
    + Received  + 2

    @@ -10,12 +10,12 @@
            "status": "ok",
            "version": "1.0.0-test",
          },
          "frontend": Object {
            "name": "figure-collector-frontend",
    -       "status": "not-registered",
    -       "version": "unknown",
    +       "status": "ok",
    +       "version": "1.0.0",
          },
          "scraper": Object {
            "name": "page-scraper",
            "status": "not-checked",
            "version": "unknown",

      169 |         .expect(200);
      170 |
    > 171 |       expect(response.body).toEqual({
          |                             ^
      172 |         application: {
      173 |           name: 'figure-collector-services',
      174 |           version: '1.0.0-test',

      at Object.<anonymous> (tests/integration/serviceEndpoints.test.ts:171:29)

  ● Service Endpoints Integration › GET /version › Version format validation › should handle empty version string

    expect(received).toBe(expected) // Object.is equality

    Expected: ""
    Received: "build-123"

      319 |           .expect(200);
      320 |
    > 321 |         expect(response.body.services.frontend.version).toBe('');
          |                                                         ^
      322 |         expect(response.body.services.frontend.status).toBe('ok');
      323 |       });
      324 |     });

      at Object.<anonymous> (tests/integration/serviceEndpoints.test.ts:321:57)

  ● Service Endpoints Integration › Service Registration and Version Flow › should complete full service registration flow

    expect(received).toBe(expected) // Object.is equality

    Expected: "not-registered"
    Received: "ok"

      332 |         .expect(200);
      333 |
    > 334 |       expect(versionResponse.body.services.frontend.status).toBe('not-registered');
          |                                                             ^
      335 |       expect(versionResponse.body.services.frontend.version).toBe('unknown');
      336 |
      337 |       // Register service

      at Object.<anonymous> (tests/integration/serviceEndpoints.test.ts:334:61)

  console.log
    Server running on port 5000

      at Server.<anonymous> (src/index.ts:183:11)

  console.log
    MongoDB Connected: localhost

      at connectWithRetry (src/config/db.ts:12:15)

FAIL tests/integration/routes/figureRoutes.test.ts
  Figure Routes Integration
    POST /figures/scrape-mfc
      ✕ should scrape MFC data successfully (public endpoint) (23 ms)
      ✕ should return error for invalid MFC URL (10 ms)
      ✕ should return error for missing MFC link (5 ms)
    GET /figures
      ✕ should get user figures with authentication (5 ms)
      ✕ should support pagination (7 ms)
      ✕ should return 401 without authentication (11 ms)
    POST /figures
      ✕ should create figure successfully (6 ms)
      ✕ should return 401 without authentication (4 ms)
    GET /figures/search
      ✕ should handle search query (5 ms)
    GET /figures/filter
      ✕ should filter figures by manufacturer (4 ms)
    GET /figures/stats
      ✕ should return figure statistics (4 ms)

  ● Figure Routes Integration › POST /figures/scrape-mfc › should scrape MFC data successfully (public endpoint)

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › POST /figures/scrape-mfc › should return error for invalid MFC URL

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › POST /figures/scrape-mfc › should return error for missing MFC link

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › GET /figures › should get user figures with authentication

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › GET /figures › should support pagination

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › GET /figures › should return 401 without authentication

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › POST /figures › should create figure successfully

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › POST /figures › should return 401 without authentication

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › GET /figures/search › should handle search query

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › GET /figures/filter › should filter figures by manufacturer

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  ● Figure Routes Integration › GET /figures/stats › should return figure statistics

    ValidationError: Figure validation failed: userId: Path `userId` is required.

      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)
      at node_modules/mongoose/lib/document.js:3012:17
      at node_modules/mongoose/lib/schematype.js:1368:9

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.log
    [MFC MAIN] Scraper service successful: {
      manufacturer: 'Good Smile Company',
      name: 'Hatsune Miku',
      scale: '1/8',
      imageUrl: 'https://example.com/image.jpg'
    }

      at scrapeDataFromMFC (src/controllers/figureController.ts:152:15)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.error
    [MFC MAIN] Scraper service failed: Service down

      158 |     
      159 |   } catch (error: any) {
    > 160 |     console.error('[MFC MAIN] Scraper service failed:', error.message);
          |             ^
      161 |     
      162 |     // If scraper service is down, try local fallback
      163 |     console.log('[MFC MAIN] Falling back to local axios method...');

      at scrapeDataFromMFC (src/controllers/figureController.ts:160:13)
      at Object.createFigure (src/controllers/figureController.ts:321:27)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:296:7)

  console.log
    [MFC MAIN] Falling back to local axios method...

      at scrapeDataFromMFC (src/controllers/figureController.ts:163:13)

  console.log
    [MFC SCRAPER] Starting scrape for URL: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:16:11)

  console.log
    [MFC SCRAPER] Making HTTP request...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:19:13)

  console.log
    [MFC SCRAPER] HTTP Response Status: 200

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:40:13)

  console.log
    [MFC SCRAPER] Response Content-Type: text/html

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:41:13)

  console.log
    [MFC SCRAPER] Response data length: 110

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:42:13)

  console.log
    [MFC SCRAPER] Loading HTML with cheerio...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:56:13)

  console.error
    [MFC SCRAPER] Error scraping MFC data: Cannot read properties of undefined (reading 'load')

      112 |     
      113 |   } catch (error: any) {
    > 114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
          |             ^
      115 |     console.error(`[MFC SCRAPER] Error details:`, {
      116 |       name: error.name,
      117 |       message: error.message,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:114:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.createFigure (src/controllers/figureController.ts:321:27)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:296:7)

  console.error
    [MFC SCRAPER] Error details: {
      name: 'TypeError',
      message: "Cannot read properties of undefined (reading 'load')",
      code: undefined,
      status: undefined,
      statusText: undefined,
      headers: undefined
    }

      113 |   } catch (error: any) {
      114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
    > 115 |     console.error(`[MFC SCRAPER] Error details:`, {
          |             ^
      116 |       name: error.name,
      117 |       message: error.message,
      118 |       code: error.code,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:115:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.createFigure (src/controllers/figureController.ts:321:27)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:296:7)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at Object.scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.error
    [MFC MAIN] Scraper service failed: Network connection failed

      158 |     
      159 |   } catch (error: any) {
    > 160 |     console.error('[MFC MAIN] Scraper service failed:', error.message);
          |             ^
      161 |     
      162 |     // If scraper service is down, try local fallback
      163 |     console.log('[MFC MAIN] Falling back to local axios method...');

      at scrapeDataFromMFC (src/controllers/figureController.ts:160:13)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:423:7)

  console.log
    [MFC MAIN] Falling back to local axios method...

      at scrapeDataFromMFC (src/controllers/figureController.ts:163:13)

  console.log
    [MFC SCRAPER] Starting scrape for URL: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:16:11)

  console.log
    [MFC SCRAPER] Making HTTP request...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:19:13)

  console.log
    [MFC SCRAPER] HTTP Response Status: 200

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:40:13)

  console.log
    [MFC SCRAPER] Response Content-Type: text/html

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:41:13)

  console.log
    [MFC SCRAPER] Response data length: 110

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:42:13)

  console.log
    [MFC SCRAPER] Loading HTML with cheerio...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:56:13)

  console.error
    [MFC SCRAPER] Error scraping MFC data: Cannot read properties of undefined (reading 'load')

      112 |     
      113 |   } catch (error: any) {
    > 114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
          |             ^
      115 |     console.error(`[MFC SCRAPER] Error details:`, {
      116 |       name: error.name,
      117 |       message: error.message,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:114:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:423:7)

  console.error
    [MFC SCRAPER] Error details: {
      name: 'TypeError',
      message: "Cannot read properties of undefined (reading 'load')",
      code: undefined,
      status: undefined,
      statusText: undefined,
      headers: undefined
    }

      113 |   } catch (error: any) {
      114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
    > 115 |     console.error(`[MFC SCRAPER] Error details:`, {
          |             ^
      116 |       name: error.name,
      117 |       message: error.message,
      118 |       code: error.code,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:115:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:423:7)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {
      imageUrl: 'MANUAL_EXTRACT:https://myfigurecollection.net/item/12345',
      manufacturer: '',
      name: '',
      scale: ''
    }

      at Object.scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at Object.scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.log
    [MFC MAIN] Scraper service successful: {}

      at scrapeDataFromMFC (src/controllers/figureController.ts:152:15)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {}

      at Object.scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at Object.scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.log
    [MFC MAIN] Scraper service successful: {
      manufacturer: 'Good Smile Company',
      name: 'Hatsune Miku',
      scale: '1/8',
      imageUrl: 'https://example.com/image.jpg'
    }

      at scrapeDataFromMFC (src/controllers/figureController.ts:152:15)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {
      manufacturer: 'Good Smile Company',
      name: 'Hatsune Miku',
      scale: '1/8',
      imageUrl: 'https://example.com/image.jpg'
    }

      at Object.scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: {}

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] No MFC link provided in request

      at Object.scrapeMFCData (src/controllers/figureController.ts:194:15)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'not-a-valid-url' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: not-a-valid-url

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] Invalid URL format: TypeError: Invalid URL
        at new URL (node:internal/url:826:25)
        at Object.scrapeMFCData (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/src/controllers/figureController.ts:205:7)
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:499:30)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34) {
      code: 'ERR_INVALID_URL',
      input: 'not-a-valid-url'
    }

      at Object.scrapeMFCData (src/controllers/figureController.ts:208:15)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://example.com/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://example.com/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] URL is not from myfigurecollection.net

      at Object.scrapeMFCData (src/controllers/figureController.ts:217:15)

  console.error
    Invalid userId for ObjectId conversion: BSONError: Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer
        at new ObjectId (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/bson/src/objectid.ts:88:15)
        at Object.getFigureStats (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/src/controllers/figureController.ts:618:22)
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:729:30)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      618 |       userObjectId = new mongoose.Types.ObjectId(userId);
      619 |     } catch (error) {
    > 620 |       console.error('Invalid userId for ObjectId conversion:', error);
          |               ^
      621 |       return res.status(400).json({
      622 |         success: false,
      623 |         message: 'Invalid user identifier'

      at Object.getFigureStats (src/controllers/figureController.ts:620:15)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:729:30)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at Object.scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.error
    [MFC MAIN] Scraper service failed: Service completely down

      158 |     
      159 |   } catch (error: any) {
    > 160 |     console.error('[MFC MAIN] Scraper service failed:', error.message);
          |             ^
      161 |     
      162 |     // If scraper service is down, try local fallback
      163 |     console.log('[MFC MAIN] Falling back to local axios method...');

      at scrapeDataFromMFC (src/controllers/figureController.ts:160:13)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:767:7)

  console.log
    [MFC MAIN] Falling back to local axios method...

      at scrapeDataFromMFC (src/controllers/figureController.ts:163:13)

  console.log
    [MFC SCRAPER] Starting scrape for URL: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:16:11)

  console.log
    [MFC SCRAPER] Making HTTP request...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:19:13)

  console.log
    [MFC SCRAPER] HTTP Response Status: 500

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:40:13)

  console.error
    [MFC SCRAPER] Error scraping MFC data: Cannot read properties of undefined (reading 'content-type')

      112 |     
      113 |   } catch (error: any) {
    > 114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
          |             ^
      115 |     console.error(`[MFC SCRAPER] Error details:`, {
      116 |       name: error.name,
      117 |       message: error.message,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:114:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:767:7)

  console.error
    [MFC SCRAPER] Error details: {
      name: 'TypeError',
      message: "Cannot read properties of undefined (reading 'content-type')",
      code: undefined,
      status: undefined,
      statusText: undefined,
      headers: undefined
    }

      113 |   } catch (error: any) {
      114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
    > 115 |     console.error(`[MFC SCRAPER] Error details:`, {
          |             ^
      116 |       name: error.name,
      117 |       message: error.message,
      118 |       code: error.code,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:115:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:767:7)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {
      imageUrl: 'MANUAL_EXTRACT:https://myfigurecollection.net/item/12345',
      manufacturer: '',
      name: '',
      scale: ''
    }

      at Object.scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at Object.scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.error
    [MFC MAIN] Scraper service failed: undefined

      158 |     
      159 |   } catch (error: any) {
    > 160 |     console.error('[MFC MAIN] Scraper service failed:', error.message);
          |             ^
      161 |     
      162 |     // If scraper service is down, try local fallback
      163 |     console.log('[MFC MAIN] Falling back to local axios method...');

      at scrapeDataFromMFC (src/controllers/figureController.ts:160:13)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:797:7)

  console.log
    [MFC MAIN] Falling back to local axios method...

      at scrapeDataFromMFC (src/controllers/figureController.ts:163:13)

  console.log
    [MFC SCRAPER] Starting scrape for URL: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:16:11)

  console.log
    [MFC SCRAPER] Making HTTP request...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:19:13)

  console.log
    [MFC SCRAPER] HTTP Response Status: 403

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:40:13)

  console.error
    [MFC SCRAPER] Error scraping MFC data: Cannot read properties of undefined (reading 'content-type')

      112 |     
      113 |   } catch (error: any) {
    > 114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
          |             ^
      115 |     console.error(`[MFC SCRAPER] Error details:`, {
      116 |       name: error.name,
      117 |       message: error.message,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:114:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:797:7)

  console.error
    [MFC SCRAPER] Error details: {
      name: 'TypeError',
      message: "Cannot read properties of undefined (reading 'content-type')",
      code: undefined,
      status: undefined,
      statusText: undefined,
      headers: undefined
    }

      113 |   } catch (error: any) {
      114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
    > 115 |     console.error(`[MFC SCRAPER] Error details:`, {
          |             ^
      116 |       name: error.name,
      117 |       message: error.message,
      118 |       code: error.code,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:115:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:797:7)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {
      imageUrl: 'MANUAL_EXTRACT:https://myfigurecollection.net/item/12345',
      manufacturer: '',
      name: '',
      scale: ''
    }

      at Object.scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at Object.scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.error
    [MFC MAIN] Scraper service failed: Scraper service completely down

      158 |     
      159 |   } catch (error: any) {
    > 160 |     console.error('[MFC MAIN] Scraper service failed:', error.message);
          |             ^
      161 |     
      162 |     // If scraper service is down, try local fallback
      163 |     console.log('[MFC MAIN] Falling back to local axios method...');

      at scrapeDataFromMFC (src/controllers/figureController.ts:160:13)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:817:7)

  console.log
    [MFC MAIN] Falling back to local axios method...

      at scrapeDataFromMFC (src/controllers/figureController.ts:163:13)

  console.log
    [MFC SCRAPER] Starting scrape for URL: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:16:11)

  console.log
    [MFC SCRAPER] Making HTTP request...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:19:13)

  console.error
    [MFC SCRAPER] Error scraping MFC data: Local axios scraping failed

      112 |     
      113 |   } catch (error: any) {
    > 114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
          |             ^
      115 |     console.error(`[MFC SCRAPER] Error details:`, {
      116 |       name: error.name,
      117 |       message: error.message,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:114:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:817:7)

  console.error
    [MFC SCRAPER] Error details: {
      name: 'Error',
      message: 'Local axios scraping failed',
      code: undefined,
      status: undefined,
      statusText: undefined,
      headers: undefined
    }

      113 |   } catch (error: any) {
      114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
    > 115 |     console.error(`[MFC SCRAPER] Error details:`, {
          |             ^
      116 |       name: error.name,
      117 |       message: error.message,
      118 |       code: error.code,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:115:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:817:7)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {
      imageUrl: 'MANUAL_EXTRACT:https://myfigurecollection.net/item/12345',
      manufacturer: '',
      name: '',
      scale: ''
    }

      at Object.scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: 'https://myfigurecollection.net/item/12345' }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] Processing MFC link: https://myfigurecollection.net/item/12345

      at Object.scrapeMFCData (src/controllers/figureController.ts:201:13)

  console.log
    [MFC ENDPOINT] URL format validation passed

      at Object.scrapeMFCData (src/controllers/figureController.ts:206:15)

  console.log
    [MFC ENDPOINT] Starting scraping process...

      at Object.scrapeMFCData (src/controllers/figureController.ts:224:13)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.error
    [MFC MAIN] Scraper service failed: undefined

      158 |     
      159 |   } catch (error: any) {
    > 160 |     console.error('[MFC MAIN] Scraper service failed:', error.message);
          |             ^
      161 |     
      162 |     // If scraper service is down, try local fallback
      163 |     console.log('[MFC MAIN] Falling back to local axios method...');

      at scrapeDataFromMFC (src/controllers/figureController.ts:160:13)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:850:7)

  console.log
    [MFC MAIN] Falling back to local axios method...

      at scrapeDataFromMFC (src/controllers/figureController.ts:163:13)

  console.log
    [MFC SCRAPER] Starting scrape for URL: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:16:11)

  console.log
    [MFC SCRAPER] Making HTTP request...

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:19:13)

  console.error
    [MFC SCRAPER] Error scraping MFC data: Local scraping blocked

      112 |     
      113 |   } catch (error: any) {
    > 114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
          |             ^
      115 |     console.error(`[MFC SCRAPER] Error details:`, {
      116 |       name: error.name,
      117 |       message: error.message,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:114:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:850:7)

  console.error
    [MFC SCRAPER] Error details: {
      name: 'Error',
      message: 'Local scraping blocked',
      code: undefined,
      status: undefined,
      statusText: undefined,
      headers: undefined
    }

      113 |   } catch (error: any) {
      114 |     console.error(`[MFC SCRAPER] Error scraping MFC data: ${error.message}`);
    > 115 |     console.error(`[MFC SCRAPER] Error details:`, {
          |             ^
      116 |       name: error.name,
      117 |       message: error.message,
      118 |       code: error.code,

      at scrapeDataFromMFCWithAxios (src/controllers/figureController.ts:115:13)
      at scrapeDataFromMFC (src/controllers/figureController.ts:165:27)
      at Object.scrapeMFCData (src/controllers/figureController.ts:225:25)
      at Object.<anonymous> (tests/controllers/figureController.test.ts:850:7)

  console.log
    [MFC ENDPOINT] Scraping completed, data: {
      imageUrl: 'MANUAL_EXTRACT:https://myfigurecollection.net/item/12345',
      manufacturer: '',
      name: '',
      scale: ''
    }

      at Object.scrapeMFCData (src/controllers/figureController.ts:226:13)

  console.log
    [MFC ENDPOINT] Received scrape request

      at Object.scrapeMFCData (src/controllers/figureController.ts:186:11)

  console.log
    [MFC ENDPOINT] Request body: { mfcLink: null }

      at Object.scrapeMFCData (src/controllers/figureController.ts:187:11)

  console.log
    [MFC ENDPOINT] Request headers: undefined

      at Object.scrapeMFCData (src/controllers/figureController.ts:188:11)

  console.log
    [MFC ENDPOINT] No MFC link provided in request

      at Object.scrapeMFCData (src/controllers/figureController.ts:194:15)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.log
    [MFC MAIN] Scraper service successful: {
      manufacturer: 'Test Manufacturer',
      name: 'Test Figure',
      imageUrl: 'https://example.com/image.jpg'
    }

      at scrapeDataFromMFC (src/controllers/figureController.ts:152:15)

  console.log
    [MFC MAIN] Starting scrape via scraper service for: https://myfigurecollection.net/item/12345

      at scrapeDataFromMFC (src/controllers/figureController.ts:135:11)

  console.log
    [MFC MAIN] Calling scraper service at: http://page-scraper-dev:3000

      at scrapeDataFromMFC (src/controllers/figureController.ts:140:13)

  console.log
    [MFC MAIN] Scraper service successful: {
      manufacturer: 'Complete Manufacturer',
      name: 'Complete Name',
      scale: '1/8',
      imageUrl: 'https://example.com/detailed-image.jpg'
    }

      at scrapeDataFromMFC (src/controllers/figureController.ts:152:15)

FAIL tests/controllers/figureController.test.ts
  FigureController
    getFigures
      ✓ should get figures with default pagination (14 ms)
      ✓ should handle pagination parameters (4 ms)
      ✓ should handle server errors (3 ms)
    getFigureById
      ✓ should get figure by id successfully (6 ms)
      ✓ should return 404 if figure not found (6 ms)
    createFigure
      ✓ should create figure successfully without scraping (77 ms)
      ✓ should create figure with MFC scraping (17 ms)
      ✓ should handle scraping service failure with fallback (10 ms)
    updateFigure
      ✓ should update figure successfully (3 ms)
      ✓ should return 404 if figure not found (3 ms)
    deleteFigure
      ✓ should delete figure successfully (2 ms)
      ✓ should return 404 if figure not found (2 ms)
    scrapeMFCData
      ✕ should handle scraper service network errors (8 ms)
      ✕ should handle invalid data from scraper service (5 ms)
      ✓ should scrape MFC data successfully (5 ms)
      ✓ should return error for missing MFC link (4 ms)
      ✓ should return error for invalid URL (5 ms)
      ✓ should return error for non-MFC URL (4 ms)
    searchFigures
      ✓ should handle database errors during search (3 ms)
      ✕ should handle invalid search query formats (4 ms)
      ✕ should handle search with very long query (4 ms)
      ✓ should search figures using MongoDB Atlas Search with comprehensive mocking (3 ms)
      ✓ should return error if query parameter is missing (2 ms)
    filterFigures
      ✓ should filter figures with multiple criteria (2 ms)
    getFigureStats
      ✓ should return figure statistics (3 ms)
      ✓ should handle invalid user ID during stats retrieval (28 ms)
      ✓ should handle database errors during statistics calculation (3 ms)
    Local MFC Scraping Fallback Scenarios
      ✕ should handle local fallback when scraper service fails completely (6 ms)
      ✕ should handle Cloudflare challenge detection during scraping (7 ms)
      ✓ should handle manual extraction when all scraping methods fail (6 ms)
    Advanced Error Handling Scenarios
      ✓ should handle invalid or blocked scraper with manual extraction marker (6 ms)
      ✓ should handle non-string input during MFC data scraping (4 ms)
      ✓ should handle empty manufacturer name during figure creation (6 ms)
      ✓ should handle server errors during figure creation (3 ms)
      ✕ should handle complex scraping data merging scenarios (3 ms)

  ● FigureController › scrapeMFCData › should handle scraper service network errors

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 500
    Received: 200

    Number of calls: 1

      423 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);
      424 |
    > 425 |       expect(mockResponse.status).toHaveBeenCalledWith(500);
          |                                   ^
      426 |       expect(mockResponse.json).toHaveBeenCalledWith({
      427 |         success: false,
      428 |         message: 'Failed to scrape MFC data',

      at Object.<anonymous> (tests/controllers/figureController.test.ts:425:35)

  ● FigureController › scrapeMFCData › should handle invalid data from scraper service

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 422
    Received: 200

    Number of calls: 1

      446 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);
      447 |
    > 448 |       expect(mockResponse.status).toHaveBeenCalledWith(422);
          |                                   ^
      449 |       expect(mockResponse.json).toHaveBeenCalledWith({
      450 |         success: false,
      451 |         message: 'Invalid or incomplete scraping data'

      at Object.<anonymous> (tests/controllers/figureController.test.ts:448:35)

  ● FigureController › searchFigures › should handle invalid search query formats

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Search query is too short or invalid",
    +   "message": "Search query is required",
        "success": false,
      },

    Number of calls: 1

      549 |
      550 |       expect(mockResponse.status).toHaveBeenCalledWith(400);
    > 551 |       expect(mockResponse.json).toHaveBeenCalledWith({
          |                                 ^
      552 |         success: false,
      553 |         message: 'Search query is too short or invalid'
      554 |       });

      at Object.<anonymous> (tests/controllers/figureController.test.ts:551:33)

  ● FigureController › searchFigures › should handle search with very long query

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 400
    Received: 500

    Number of calls: 1

      560 |       await figureController.searchFigures(mockRequest as Request, mockResponse as Response);
      561 |
    > 562 |       expect(mockResponse.status).toHaveBeenCalledWith(400);
          |                                   ^
      563 |       expect(mockResponse.json).toHaveBeenCalledWith({
      564 |         success: false,
      565 |         message: 'Search query is too long'

      at Object.<anonymous> (tests/controllers/figureController.test.ts:562:35)

  ● FigureController › Local MFC Scraping Fallback Scenarios › should handle local fallback when scraper service fails completely

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 500
    Received: 200

    Number of calls: 1

      767 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);
      768 |
    > 769 |       expect(mockResponse.status).toHaveBeenCalledWith(500);
          |                                   ^
      770 |       expect(mockResponse.json).toHaveBeenCalledWith(
      771 |         expect.objectContaining({
      772 |           success: false,

      at Object.<anonymous> (tests/controllers/figureController.test.ts:769:35)

  ● FigureController › Local MFC Scraping Fallback Scenarios › should handle Cloudflare challenge detection during scraping

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: 500
    Received: 200

    Number of calls: 1

      797 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);
      798 |
    > 799 |       expect(mockResponse.status).toHaveBeenCalledWith(500);
          |                                   ^
      800 |       expect(mockResponse.json).toHaveBeenCalledWith(
      801 |         expect.objectContaining({
      802 |           success: false,

      at Object.<anonymous> (tests/controllers/figureController.test.ts:799:35)

  ● FigureController › Advanced Error Handling Scenarios › should handle complex scraping data merging scenarios

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"imageUrl": "https://example.com/detailed-image.jpg", "manufacturer": "Complete Manufacturer", "name": "Complete Name", "scale": "1/8"}
    Received: {"boxNumber": "", "imageUrl": "https://example.com/detailed-image.jpg", "location": "", "manufacturer": "Partial Manufacturer", "mfcLink": "https://myfigurecollection.net/item/12345", "name": "Complete Name", "scale": "1/8", "userId": "000000000000000000000123"}

    Number of calls: 1

      968 |       await figureController.createFigure(mockRequest as Request, mockResponse as Response);
      969 |
    > 970 |       expect(MockedFigure.create).toHaveBeenCalledWith(expect.objectContaining({
          |                                   ^
      971 |         manufacturer: 'Complete Manufacturer',
      972 |         name: 'Complete Name',
      973 |         scale: '1/8',

      at Object.<anonymous> (tests/controllers/figureController.test.ts:970:35)

FAIL tests/middleware/authMiddleware.test.ts
  AuthMiddleware
    protect middleware
      ✕ should authenticate valid token and call next (11 ms)
      ✕ should issue new token when current token is close to expiry (7 ms)
      ✓ should not issue new token when current token has plenty of time left (6 ms)
      ✓ should return 401 for invalid token (75 ms)
      ✓ should return 401 for expired token (6 ms)
      ✓ should return 401 for missing authorization header (8 ms)
      ✓ should return 401 for malformed authorization header (10 ms)
      ✕ should return 401 for Bearer header without token (6 ms)
      ✓ should handle JWT verification errors gracefully (3 ms)
      Token refresh logic
        ✓ should calculate time until expiry correctly (2 ms)
        ✓ should not refresh token when more than 15 minutes remain (3 ms)
    admin middleware
      ✓ should allow admin users to proceed (2 ms)
      ✓ should deny non-admin users (3 ms)
      ✓ should deny access if user not found (2 ms)
      ✓ should handle database errors (2 ms)
      ✓ should handle missing user in request (3 ms)
    Middleware integration
      ✓ should work with protect middleware followed by admin middleware (2 ms)
    Edge cases
      ✓ should handle token with missing exp field (3 ms)
      ✕ should handle extremely long tokens (2 ms)
      ✕ should handle special characters in tokens (2 ms)

  ● AuthMiddleware › protect middleware › should authenticate valid token and call next

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "valid-token", "test-secret"
    Received: "valid-token", "secret"

    Number of calls: 1

      48 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);
      49 |
    > 50 |       expect(mockedJwt.verify).toHaveBeenCalledWith('valid-token', 'test-secret');
         |                                ^
      51 |       expect(mockRequest.user).toEqual({ id: 'user123' });
      52 |       expect(mockNext).toHaveBeenCalled();
      53 |       expect(mockResponse.status).not.toHaveBeenCalled();

      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:50:32)

  ● AuthMiddleware › protect middleware › should issue new token when current token is close to expiry

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"id": "user123"},
    - "test-secret",
    + "secret",
      {"expiresIn": "60m"},

    Number of calls: 1

      69 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);
      70 |
    > 71 |       expect(mockedJwt.sign).toHaveBeenCalledWith(
         |                              ^
      72 |         { id: 'user123' },
      73 |         'test-secret',
      74 |         { expiresIn: '60m' }

      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:71:30)

  ● AuthMiddleware › protect middleware › should return 401 for Bearer header without token

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "message": "Not authorized, no token",
    +   "message": "Not authorized, token failed",
        "success": false,
      },

    Number of calls: 1

      173 |
      174 |       expect(mockResponse.status).toHaveBeenCalledWith(401);
    > 175 |       expect(mockResponse.json).toHaveBeenCalledWith({
          |                                 ^
      176 |         success: false,
      177 |         message: 'Not authorized, no token'
      178 |       });

      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:175:33)

  ● AuthMiddleware › Edge cases › should handle extremely long tokens

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa", "test-secret"
    Received: "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa", "secret"

    Number of calls: 1

      395 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);
      396 |
    > 397 |       expect(mockedJwt.verify).toHaveBeenCalledWith('a'.repeat(1000), 'test-secret');
          |                                ^
      398 |       expect(mockNext).toHaveBeenCalled();
      399 |     });
      400 |

      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:397:32)

  ● AuthMiddleware › Edge cases › should handle special characters in tokens

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "token.with-special_chars+symbols=", "test-secret"
    Received: "token.with-special_chars+symbols=", "secret"

    Number of calls: 1

      414 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);
      415 |
    > 416 |       expect(mockedJwt.verify).toHaveBeenCalledWith('token.with-special_chars+symbols=', 'test-secret');
          |                                ^
      417 |       expect(mockNext).toHaveBeenCalled();
      418 |     });
      419 |   });

      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:416:32)

  console.error
    Error [CastError]: Cast to ObjectId failed
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/middleware/validationMiddleware.test.ts:194:25)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      107 | // SECURITY FIX: Enhanced global error handler with CastError handling
      108 | export const globalErrorHandler = (err: Error, req: Request, res: Response, next: NextFunction) => {
    > 109 |   console.error(err);
          |           ^
      110 |
      111 |   // Handle Mongoose CastError (invalid ObjectId) as validation error, not server error
      112 |   if (err.name === 'CastError' && err.message.includes('ObjectId')) {

      at globalErrorHandler (src/middleware/validationMiddleware.ts:109:11)
      at Object.<anonymous> (tests/unit/middleware/validationMiddleware.test.ts:197:25)

  console.error
    Error [ValidationError]: Validation failed
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/middleware/validationMiddleware.test.ts:207:31)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34) {
      errors: { name: { message: 'Name is required', path: 'name' } }
    }

      107 | // SECURITY FIX: Enhanced global error handler with CastError handling
      108 | export const globalErrorHandler = (err: Error, req: Request, res: Response, next: NextFunction) => {
    > 109 |   console.error(err);
          |           ^
      110 |
      111 |   // Handle Mongoose CastError (invalid ObjectId) as validation error, not server error
      112 |   if (err.name === 'CastError' && err.message.includes('ObjectId')) {

      at globalErrorHandler (src/middleware/validationMiddleware.ts:109:11)
      at Object.<anonymous> (tests/unit/middleware/validationMiddleware.test.ts:213:25)

  console.error
    SyntaxError: JSON parse error
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/middleware/validationMiddleware.test.ts:226:25)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      107 | // SECURITY FIX: Enhanced global error handler with CastError handling
      108 | export const globalErrorHandler = (err: Error, req: Request, res: Response, next: NextFunction) => {
    > 109 |   console.error(err);
          |           ^
      110 |
      111 |   // Handle Mongoose CastError (invalid ObjectId) as validation error, not server error
      112 |   if (err.name === 'CastError' && err.message.includes('ObjectId')) {

      at globalErrorHandler (src/middleware/validationMiddleware.ts:109:11)
      at Object.<anonymous> (tests/unit/middleware/validationMiddleware.test.ts:230:25)

  console.error
    Error: Unknown server error
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/middleware/validationMiddleware.test.ts:239:28)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      107 | // SECURITY FIX: Enhanced global error handler with CastError handling
      108 | export const globalErrorHandler = (err: Error, req: Request, res: Response, next: NextFunction) => {
    > 109 |   console.error(err);
          |           ^
      110 |
      111 |   // Handle Mongoose CastError (invalid ObjectId) as validation error, not server error
      112 |   if (err.name === 'CastError' && err.message.includes('ObjectId')) {

      at globalErrorHandler (src/middleware/validationMiddleware.ts:109:11)
      at Object.<anonymous> (tests/unit/middleware/validationMiddleware.test.ts:241:25)

FAIL tests/unit/middleware/validationMiddleware.test.ts
  Validation Middleware
    validateRequest
      ✓ should pass validation for valid figure payload (10 ms)
      ✓ should fail validation for invalid figure payload (5 ms)
      ✓ should reject unknown properties by default (7 ms)
    validateContentType
      ✓ should pass when content type is allowed (4 ms)
      ✓ should reject when content type is not allowed (56 ms)
      ✓ should reject when no content type is provided (4 ms)
    validateObjectId
      ✓ should pass for valid ObjectId (5 ms)
      ✓ should reject when id is missing (5 ms)
      ✓ should reject invalid ObjectId (2 ms)
    globalErrorHandler
      ✓ should handle Mongoose CastError for invalid ObjectId (12 ms)
      ✓ should handle Mongoose ValidationError (3 ms)
      ✓ should handle JSON parsing errors (2 ms)
      ✓ should handle unhandled errors with 500 status (3 ms)
    Validation Schemas
      Figure Schema
        ✓ should validate figure with all optional fields (2 ms)
        ✓ should reject figure with invalid type (3 ms)
      User Schema
        ✓ should validate strong password (2 ms)
        ✕ should reject weak passwords (3 ms)
        ✓ should reject invalid email domains (2 ms)
      Pagination Schema
        ✓ should validate valid pagination parameters (1 ms)
        ✓ should set default values when not provided (2 ms)
        ✓ should reject invalid pagination parameters (2 ms)

  ● Validation Middleware › Validation Schemas › User Schema › should reject weak passwords

    expect(received).toBeDefined()

    Received: undefined

      314 |         weakPasswords.forEach(userData => {
      315 |           const { error } = user.validate(userData);
    > 316 |           expect(error).toBeDefined();
          |                         ^
      317 |           expect(error?.details[0].path).toContain('password');
      318 |         });
      319 |       });

      at tests/unit/middleware/validationMiddleware.test.ts:316:25
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (tests/unit/middleware/validationMiddleware.test.ts:314:23)

FAIL tests/unit/atlasSearchMock.test.ts
  Atlas Search Mock Validation
    Basic Search Functionality
      ✓ should find exact matches by name (11 ms)
      ✓ should find matches by manufacturer (3 ms)
      ✓ should find matches by location (2 ms)
      ✓ should find matches by box number (7 ms)
      ✓ should perform case-insensitive search (11 ms)
      ✕ should perform precise whole word matching (71 ms)
      ✓ should return empty array for no matches (8 ms)
    User Isolation
      ✓ should only return results for the specified user (4 ms)
      ✓ should not return results for other users (2 ms)
      ✓ should return results for the correct user (3 ms)
    Response Format Validation
      ✕ should return correct response format (2 ms)
    Multi-field Search
      ✕ should search across all specified fields (2 ms)
    Fuzzy Matching Simulation
      ✕ should match with substring search (2 ms)
      ✓ should match with prefix search (2 ms)
      ✓ should require precise matching (2 ms)

  ● Atlas Search Mock Validation › Basic Search Functionality › should perform precise whole word matching

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      162 |       const results = testMockAtlasSearch('Rin', testDocuments, testUserId);
      163 |       
    > 164 |       expect(results).toHaveLength(1);
          |                       ^
      165 |       expect(results[0].name).toBe('Kagamine Rin');
      166 |     });
      167 |

      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:164:23)

  ● Atlas Search Mock Validation › Response Format Validation › should return correct response format

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      203 |       const results = testMockAtlasSearch('Miku', testDocuments, testUserId);
      204 |       
    > 205 |       expect(results).toHaveLength(1);
          |                       ^
      206 |       const result = results[0];
      207 |       
      208 |       // Check all required fields are present

      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:205:23)

  ● Atlas Search Mock Validation › Multi-field Search › should search across all specified fields

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      247 |       // Test that search looks in boxNumber field
      248 |       results = testMockAtlasSearch('003', testDocuments, testUserId);
    > 249 |       expect(results).toHaveLength(1);
          |                       ^
      250 |       expect(results[0].boxNumber).toBe('Box 003');
      251 |     });
      252 |   });

      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:249:23)

  ● Atlas Search Mock Validation › Fuzzy Matching Simulation › should match with substring search

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      256 |       const results = testMockAtlasSearch('Rin', testDocuments, testUserId);
      257 |       
    > 258 |       expect(results).toHaveLength(1);
          |                       ^
      259 |       expect(results[0].name).toBe('Kagamine Rin');
      260 |     });
      261 |

      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:258:23)

FAIL tests/controllers/userController.test.ts
  UserController
    registerUser
      ✓ should register a new user successfully (12 ms)
      ✓ should return error if user already exists by email (3 ms)
      ✓ should return error if user already exists by username (7 ms)
      ✓ should handle server errors (8 ms)
      ✓ should handle missing required fields (85 ms)
    loginUser
      ✓ should login user successfully (4 ms)
      ✓ should return error for non-existent user (7 ms)
      ✓ should return error for incorrect password (6 ms)
      ✓ should handle server errors (3 ms)
    getUserProfile
      ✓ should get user profile successfully (2 ms)
      ✓ should return error if user not found (3 ms)
      ✓ should handle server errors (2 ms)
    updateUserProfile
      ✓ should update user profile successfully (3 ms)
      ✓ should update only provided fields (2 ms)
      ✓ should return error if user not found (2 ms)
      ✓ should handle server errors (2 ms)
      ✓ should handle save errors (7 ms)
    Token Generation
      ✕ should generate JWT token with correct payload (3 ms)

  ● UserController › Token Generation › should generate JWT token with correct payload

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      {"id": "user123"},
    - "test-secret",
    + "secret",
      {"expiresIn": "60m"},

    Number of calls: 1

      433 |       await loginUser(mockRequest as Request, mockResponse as Response);
      434 |
    > 435 |       expect(mockedJwt.sign).toHaveBeenCalledWith(
          |                              ^
      436 |         { id: 'user123' },
      437 |         'test-secret',
      438 |         { expiresIn: '60m' }

      at Object.<anonymous> (tests/controllers/userController.test.ts:435:30)

  console.log
    MongoDB Connected: custom-host:27017

      at connectWithRetry (src/config/db.ts:12:15)

  console.error
    MongoDB connection failed during testing Error: Connection failed
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:71:32)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      14 |       if (process.env.NODE_ENV === 'test') {
      15 |         // In test environment, just log the error without exiting
    > 16 |         console.error('MongoDB connection failed during testing', err);
         |                 ^
      17 |         return;
      18 |       }
      19 |

      at connectWithRetry (src/config/db.ts:16:17)
      at connectDB (src/config/db.ts:30:3)

  console.error
    MongoDB connection failed during testing Error: Connection failed
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:72:32)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      14 |       if (process.env.NODE_ENV === 'test') {
      15 |         // In test environment, just log the error without exiting
    > 16 |         console.error('MongoDB connection failed during testing', err);
         |                 ^
      17 |         return;
      18 |       }
      19 |

      at connectWithRetry (src/config/db.ts:16:17)
      at connectDB (src/config/db.ts:30:3)
      at Object.<anonymous> (tests/config/db.test.ts:109:7)

  console.log
    MongoDB Connected: localhost:27017

      at connectWithRetry (src/config/db.ts:12:15)

  console.error
    MongoDB connection failed during testing Error: ECONNREFUSED
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:120:28)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      14 |       if (process.env.NODE_ENV === 'test') {
      15 |         // In test environment, just log the error without exiting
    > 16 |         console.error('MongoDB connection failed during testing', err);
         |                 ^
      17 |         return;
      18 |       }
      19 |

      at connectWithRetry (src/config/db.ts:16:17)
      at connectDB (src/config/db.ts:30:3)
      at Object.<anonymous> (tests/config/db.test.ts:151:7)

  console.log
    MongoDB Connected: localhost:27017

      at connectWithRetry (src/config/db.ts:12:15)

  console.error
    MongoDB connection failed during testing Error: Connection failed
        at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:182:48)
        at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)
        at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)

      14 |       if (process.env.NODE_ENV === 'test') {
      15 |         // In test environment, just log the error without exiting
    > 16 |         console.error('MongoDB connection failed during testing', err);
         |                 ^
      17 |         return;
      18 |       }
      19 |

      at connectWithRetry (src/config/db.ts:16:17)
      at connectDB (src/config/db.ts:30:3)
      at Object.<anonymous> (tests/config/db.test.ts:191:7)

  console.log
    MongoDB Connected: localhost:27017

      at connectWithRetry (src/config/db.ts:12:15)

  console.log
    MongoDB Connected: localhost:27017

      at connectWithRetry (src/config/db.ts:12:15)

  console.log
    MongoDB Connected: test-cluster.mongodb.net:27017

      at connectWithRetry (src/config/db.ts:12:15)

  console.log
    MongoDB Connected: undefined

      at connectWithRetry (src/config/db.ts:12:15)

FAIL tests/config/db.test.ts
  Database Configuration
    connectDB
      ✕ should connect to MongoDB successfully (12 ms)
      ✕ should use custom MongoDB URI from environment (6 ms)
      ✕ should retry connection on failure and eventually succeed (9 ms)
      ✕ should exit process after maximum retries (39 ms)
      ✕ should handle different types of connection errors (3 ms)
      ✕ should handle authentication errors (9 ms)
    Retry Logic
      ✕ should use correct retry delays (35 ms)
      ✕ should decrement retries correctly (3 ms)
    Environment Configuration
      ✕ should handle missing MONGODB_URI environment variable (3 ms)
      ✕ should handle empty MONGODB_URI environment variable (3 ms)
    Connection State
      ✕ should log correct host information (2 ms)
      ✕ should handle undefined connection host (3 ms)

  ● Database Configuration › connectDB › should connect to MongoDB successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "mongodb://localhost:27017/figure-collector"
    Received: "mongodb://127.0.0.1:45975/"

    Number of calls: 1

      42 |       await connectDB();
      43 |
    > 44 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(
         |                                      ^
      45 |         'mongodb://localhost:27017/figure-collector'
      46 |       );
      47 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: localhost:27017');

      at Object.<anonymous> (tests/config/db.test.ts:44:38)

  ● Database Configuration › connectDB › should use custom MongoDB URI from environment

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "mongodb://custom-host:27017/custom-db"
    Received: "mongodb://127.0.0.1:45975/"

    Number of calls: 1

      59 |       await connectDB();
      60 |
    > 61 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(
         |                                      ^
      62 |         'mongodb://custom-host:27017/custom-db'
      63 |       );
      64 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: custom-host:27017');

      at Object.<anonymous> (tests/config/db.test.ts:61:38)

  ● Database Configuration › connectDB › should retry connection on failure and eventually succeed

    expect(received).toHaveBeenCalledTimes(expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function setTimeout]

      80 |
      81 |       // Fast-forward first retry
    > 82 |       expect(setTimeout).toHaveBeenCalledTimes(1);
         |                          ^
      83 |       jest.runOnlyPendingTimers();
      84 |
      85 |       // Fast-forward second retry

      at Object.<anonymous> (tests/config/db.test.ts:82:26)

  ● Database Configuration › connectDB › should exit process after maximum retries

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      107 |       }
      108 |
    > 109 |       await expect(connectPromise).rejects.toThrow('Process.exit called with code 1');
          |             ^
      110 |
      111 |       expect(mockedMongoose.connect).toHaveBeenCalledTimes(6); // Initial + 5 retries
      112 |       expect(consoleErrorSpy).toHaveBeenCalledWith(

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/config/db.test.ts:109:13)

  ● Database Configuration › connectDB › should handle different types of connection errors

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "MongoDB connection failed, retrying in 5000ms..."

    Number of calls: 0

      132 |       await connectPromise;
      133 |
    > 134 |       expect(consoleLogSpy).toHaveBeenCalledWith(
          |                             ^
      135 |         'MongoDB connection failed, retrying in 5000ms...'
      136 |       );
      137 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: localhost:27017');

      at Object.<anonymous> (tests/config/db.test.ts:134:29)

  ● Database Configuration › connectDB › should handle authentication errors

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      149 |       }
      150 |
    > 151 |       await expect(connectPromise).rejects.toThrow('Process.exit called with code 1');
          |             ^
      152 |
      153 |       expect(consoleErrorSpy).toHaveBeenCalledWith(
      154 |         'MongoDB connection failed after multiple attempts',

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/config/db.test.ts:151:13)

  ● Database Configuration › Retry Logic › should use correct retry delays

    expect(received).toHaveBeenCalledWith(...expected)

    Matcher error: received value must be a mock or spy function

    Received has type:  function
    Received has value: [Function setTimeout]

      165 |
      166 |       // Check that setTimeout is called with correct delay
    > 167 |       expect(setTimeout).toHaveBeenCalledWith(expect.any(Function), 5000);
          |                          ^
      168 |
      169 |       jest.runOnlyPendingTimers();
      170 |       expect(setTimeout).toHaveBeenCalledTimes(2);

      at Object.<anonymous> (tests/config/db.test.ts:167:26)

  ● Database Configuration › Retry Logic › should decrement retries correctly

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      189 |       }
      190 |
    > 191 |       await expect(connectPromise).rejects.toThrow('Process.exit called with code 1');
          |             ^
      192 |
      193 |       // Should have attempted connection 6 times total (initial + 5 retries)
      194 |       expect(mockedMongoose.connect).toHaveBeenCalledTimes(6);

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (tests/config/db.test.ts:191:13)

  ● Database Configuration › Environment Configuration › should handle missing MONGODB_URI environment variable

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "mongodb://localhost:27017/figure-collector"
    Received: "mongodb://127.0.0.1:45975/"

    Number of calls: 1

      208 |       await connectDB();
      209 |
    > 210 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(
          |                                      ^
      211 |         'mongodb://localhost:27017/figure-collector'
      212 |       );
      213 |

      at Object.<anonymous> (tests/config/db.test.ts:210:38)

  ● Database Configuration › Environment Configuration › should handle empty MONGODB_URI environment variable

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "mongodb://localhost:27017/figure-collector"
    Received: "mongodb://127.0.0.1:45975/"

    Number of calls: 1

      226 |       await connectDB();
      227 |
    > 228 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(
          |                                      ^
      229 |         'mongodb://localhost:27017/figure-collector'
      230 |       );
      231 |

      at Object.<anonymous> (tests/config/db.test.ts:228:38)

  ● Database Configuration › Connection State › should log correct host information

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "MongoDB Connected: test-cluster.mongodb.net:27017"

    Number of calls: 0

      244 |       await connectDB();
      245 |
    > 246 |       expect(consoleLogSpy).toHaveBeenCalledWith(`MongoDB Connected: ${testHost}`);
          |                             ^
      247 |     });
      248 |
      249 |     it('should handle undefined connection host', async () => {

      at Object.<anonymous> (tests/config/db.test.ts:246:29)

  ● Database Configuration › Connection State › should handle undefined connection host

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "MongoDB Connected: undefined"

    Number of calls: 0

      255 |       await connectDB();
      256 |
    > 257 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: undefined');
          |                             ^
      258 |     });
      259 |   });
      260 | });

      at Object.<anonymous> (tests/config/db.test.ts:257:29)

FAIL tests/integration/database/dbConnection.test.ts
  Database Connection Retry Logic
    ✓ should successfully connect to MongoDB (17 ms)
    ✕ should retry connection multiple times before failing (1 ms)
    ✕ should exit process after maximum retry attempts (1 ms)
    ✕ should handle invalid MongoDB URI gracefully (1 ms)
    ✕ should log connection host on successful connection

  ● Database Connection Retry Logic › should retry connection multiple times before failing

    MongoNotConnectedError: Client must be connected before running operations

      48 |   for (const key in collections) {
      49 |     const collection = collections[key];
    > 50 |     await collection.deleteMany({});
         |                      ^
      51 |   }
      52 | });
      53 |

      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)
      at node_modules/mongodb/src/operations/execute_operation.ts:79:30
      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)
      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)
      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)
      at Object.<anonymous> (tests/testSetup.ts:50:22)

  ● Database Connection Retry Logic › should exit process after maximum retry attempts

    MongoNotConnectedError: Client must be connected before running operations

      48 |   for (const key in collections) {
      49 |     const collection = collections[key];
    > 50 |     await collection.deleteMany({});
         |                      ^
      51 |   }
      52 | });
      53 |

      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)
      at node_modules/mongodb/src/operations/execute_operation.ts:79:30
      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)
      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)
      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)
      at Object.<anonymous> (tests/testSetup.ts:50:22)

  ● Database Connection Retry Logic › should handle invalid MongoDB URI gracefully

    MongoNotConnectedError: Client must be connected before running operations

      48 |   for (const key in collections) {
      49 |     const collection = collections[key];
    > 50 |     await collection.deleteMany({});
         |                      ^
      51 |   }
      52 | });
      53 |

      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)
      at node_modules/mongodb/src/operations/execute_operation.ts:79:30
      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)
      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)
      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)
      at Object.<anonymous> (tests/testSetup.ts:50:22)

  ● Database Connection Retry Logic › should log connection host on successful connection

    MongoNotConnectedError: Client must be connected before running operations

      48 |   for (const key in collections) {
      49 |     const collection = collections[key];
    > 50 |     await collection.deleteMany({});
         |                      ^
      51 |   }
      52 | });
      53 |

      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)
      at node_modules/mongodb/src/operations/execute_operation.ts:79:30
      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)
      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)
      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)
      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)
      at Object.<anonymous> (tests/testSetup.ts:50:22)

PASS tests/models/Figure.test.ts
  Figure Model
    Schema Validation
      ✓ should create a valid figure with required fields (75 ms)
      ✓ should require manufacturer field (133 ms)
      ✓ should require name field (55 ms)
      ✓ should require userId field (50 ms)
      ✓ should accept all optional fields (52 ms)
      ✓ should handle empty string values for optional fields (53 ms)
    User Reference
      ✓ should properly reference a user (62 ms)
      ✓ should fail with invalid userId (51 ms)
    Indexes
      ✓ should have indexes on manufacturer and name (57 ms)
      ✓ should support compound index queries (58 ms)
    Timestamps
      ✓ should automatically set createdAt and updatedAt (55 ms)
      ✓ should update updatedAt on save (65 ms)
    Data Types and Edge Cases
      ✓ should handle long strings (52 ms)
      ✓ should handle special characters (51 ms)
      ✓ should handle URL formats in mfcLink and imageUrl (51 ms)
    Query Operations
      ✓ should find figures by manufacturer (56 ms)
      ✓ should find figures by scale (57 ms)
      ✓ should find figures by location (54 ms)
      ✓ should support regex queries (54 ms)
      ✓ should support sorting (55 ms)

PASS tests/models/User.test.ts
  User Model
    Schema Validation
      ✓ should create a valid user with required fields (73 ms)
      ✓ should require username field (100 ms)
      ✓ should require email field (11 ms)
      ✓ should require password field (3 ms)
      ✓ should enforce unique username (100 ms)
      ✓ should enforce unique email (97 ms)
    Password Hashing
      ✓ should hash password before saving (51 ms)
      ✓ should not hash password if not modified (54 ms)
      ✓ should rehash password if modified (98 ms)
    comparePassword Method
      ✓ should return true for correct password (100 ms)
      ✓ should return false for incorrect password (95 ms)
      ✓ should return false for empty password (94 ms)
      ✓ should handle special characters in password (144 ms)
    Default Values
      ✓ should set isAdmin to false by default (50 ms)
      ✓ should allow setting isAdmin to true (50 ms)
    Timestamps
      ✓ should automatically set createdAt and updatedAt (49 ms)
      ✓ should update updatedAt on save (63 ms)

  console.log
    Skipping transaction test - transactions not supported (replica set required)

      at Object.<anonymous> (tests/integration/database.test.ts:280:19)

  console.log
    Inserted 100 figures in 43ms

      at Object.<anonymous> (tests/integration/database.test.ts:496:15)

  console.log
    Queried filtered results in 2ms

      at Object.<anonymous> (tests/integration/database.test.ts:506:15)

  console.log
    Aggregation completed in 2ms

      at Object.<anonymous> (tests/integration/database.test.ts:518:15)

PASS tests/integration/database.test.ts
  Database Integration Tests
    Connection Management
      ✓ should handle connection states properly (10 ms)
      ✓ should handle database operations when connected (150 ms)
    Collection Operations
      ✓ should handle bulk operations on User collection (62 ms)
      ✓ should handle bulk operations on Figure collection (60 ms)
    Index Performance Tests
      ✓ should utilize indexes for User queries (17 ms)
      ✓ should utilize compound indexes for Figure queries (74 ms)
    Transaction Support
      ✓ should handle transactions when supported (56 ms)
      ✓ should handle failed transactions properly (61 ms)
    Data Integrity Tests
      ✓ should enforce unique constraints (152 ms)
      ✓ should enforce required fields (8 ms)
      ✓ should handle foreign key relationships (68 ms)
    Performance Tests
      ✓ should handle large dataset queries efficiently (102 ms)

PASS tests/integration/inter-service/interServiceCommunication.test.ts
  Inter-Service Communication
    Backend → Scraper Service Communication
      ✓ should successfully call scraper service for MFC data (10 ms)
    Backend → Version Service Communication
      ✓ should fetch app version from Version Service (3 ms)
      ✓ should validate version combinations via Version Service (5 ms)
    Backend Service Registration and Version Aggregation
      ✓ should register frontend service successfully (31 ms)
      ✓ should aggregate service versions (96 ms)
    Complete Workflow Integration
      ✓ should perform end-to-end figure creation with version validation (17 ms)

Test Suites: 14 failed, 4 passed, 18 total
Tests:       85 failed, 231 passed, 316 total
Snapshots:   0 total
Time:        22.713 s
Ran all test suites.
{"numFailedTestSuites":14,"numFailedTests":85,"numPassedTestSuites":4,"numPassedTests":231,"numPendingTestSuites":0,"numPendingTests":0,"numRuntimeErrorTestSuites":0,"numTodoTests":0,"numTotalTestSuites":18,"numTotalTests":316,"openHandles":[{}],"snapshot":{"added":0,"didUpdate":false,"failure":false,"filesAdded":0,"filesRemoved":0,"filesRemovedList":[],"filesUnmatched":0,"filesUpdated":0,"matched":0,"total":0,"unchecked":0,"uncheckedKeysByFile":[],"unmatched":0,"updated":0},"startTime":1756365903978,"success":false,"testResults":[{"assertionResults":[{"ancestorTitles":["Performance and Stress Tests","Database Performance Tests"],"duration":174,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Database Performance Tests should handle bulk figure creation efficiently","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle bulk figure creation efficiently"},{"ancestorTitles":["Performance and Stress Tests","Database Performance Tests"],"duration":162,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Database Performance Tests should handle complex aggregation queries efficiently","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle complex aggregation queries efficiently"},{"ancestorTitles":["Performance and Stress Tests","Database Performance Tests"],"duration":150,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Database Performance Tests should handle concurrent database operations","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle concurrent database operations"},{"ancestorTitles":["Performance and Stress Tests","API Endpoint Performance Tests"],"duration":110,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests API Endpoint Performance Tests should handle GET /figures with pagination efficiently","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle GET /figures with pagination efficiently"},{"ancestorTitles":["Performance and Stress Tests","API Endpoint Performance Tests"],"duration":249,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests API Endpoint Performance Tests should handle multiple concurrent GET requests","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle multiple concurrent GET requests"},{"ancestorTitles":["Performance and Stress Tests","API Endpoint Performance Tests"],"duration":186,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests API Endpoint Performance Tests should handle rapid POST requests efficiently","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle rapid POST requests efficiently"},{"ancestorTitles":["Performance and Stress Tests","API Endpoint Performance Tests"],"duration":79,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/performance/stress.test.ts:250:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Performance and Stress Tests API Endpoint Performance Tests should handle filter queries efficiently","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle filter queries efficiently"},{"ancestorTitles":["Performance and Stress Tests","API Endpoint Performance Tests"],"duration":84,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests API Endpoint Performance Tests should handle stats calculation efficiently","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle stats calculation efficiently"},{"ancestorTitles":["Performance and Stress Tests","Memory and Resource Usage Tests"],"duration":57,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Memory and Resource Usage Tests should handle large JSON payloads without memory issues","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle large JSON payloads without memory issues"},{"ancestorTitles":["Performance and Stress Tests","Memory and Resource Usage Tests"],"duration":312,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Memory and Resource Usage Tests should handle rapid authentication cycles","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle rapid authentication cycles"},{"ancestorTitles":["Performance and Stress Tests","Error Handling Under Load"],"duration":139,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Error Handling Under Load should handle concurrent invalid requests gracefully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle concurrent invalid requests gracefully"},{"ancestorTitles":["Performance and Stress Tests","Error Handling Under Load"],"duration":238,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Error Handling Under Load should maintain performance under mixed valid/invalid load","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should maintain performance under mixed valid/invalid load"},{"ancestorTitles":["Performance and Stress Tests","Scalability Tests"],"duration":135,"failureDetails":[],"failureMessages":[],"fullName":"Performance and Stress Tests Scalability Tests should maintain response times as data grows","invocations":1,"location":null,"numPassingAsserts":8,"retryReasons":[],"status":"passed","title":"should maintain response times as data grows"}],"endTime":1756365907334,"message":"  ● Performance and Stress Tests › API Endpoint Performance Tests › should handle filter queries efficiently\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      248 |         .get('/figures/filter?manufacturer=API Manufacturer 0&scale=1/8')\n      249 |         .set('Authorization', `Bearer ${authToken}`)\n    > 250 |         .expect(200);\n          |          ^\n      251 |\n      252 |       const responseTime = Date.now() - startTime;\n      253 |\n\n      at Object.<anonymous> (tests/performance/stress.test.ts:250:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/performance/stress.test.ts","startTime":1756365904109,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Figure Routes Integration","POST /figures/scrape-mfc"],"duration":159,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration POST /figures/scrape-mfc should scrape MFC data successfully (public endpoint)","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should scrape MFC data successfully (public endpoint)"},{"ancestorTitles":["Figure Routes Integration","POST /figures/scrape-mfc"],"duration":64,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration POST /figures/scrape-mfc should return error for invalid MFC URL","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error for invalid MFC URL"},{"ancestorTitles":["Figure Routes Integration","POST /figures/scrape-mfc"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration POST /figures/scrape-mfc should return error for missing MFC link","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error for missing MFC link"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":73,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures should get user figures with authentication","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should get user figures with authentication"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":63,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures should support pagination","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should support pagination"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":87,"failureDetails":[{"matcherResult":{"actual":3,"expected":4,"message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: 4\nReceived: 3","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: 4\nReceived: 3\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:186:37)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Figure Routes Integration GET /figures should handle advanced pagination scenarios","invocations":1,"location":null,"numPassingAsserts":8,"retryReasons":[],"status":"failed","title":"should handle advanced pagination scenarios"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":60,"failureDetails":[{}],"failureMessages":["Error: expected 400 \"Bad Request\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:206:12)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures should handle pagination edge cases","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle pagination edge cases"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures should return 401 without authentication","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 401 without authentication"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":112,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures should only return figures belonging to authenticated user","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should only return figures belonging to authenticated user"},{"ancestorTitles":["Figure Routes Integration","POST /figures"],"duration":61,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration POST /figures should create figure successfully without scraping","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should create figure successfully without scraping"},{"ancestorTitles":["Figure Routes Integration","POST /figures"],"duration":56,"failureDetails":[{}],"failureMessages":["Error: expected 201 \"Created\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:314:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration POST /figures should create figure with MFC scraping","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should create figure with MFC scraping"},{"ancestorTitles":["Figure Routes Integration","POST /figures"],"duration":57,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration POST /figures should return 401 without authentication","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 401 without authentication"},{"ancestorTitles":["Figure Routes Integration","POST /figures"],"duration":56,"failureDetails":[{"matcherResult":{"message":"expect(received).toMatch(expected)\n\nExpected pattern: /validation failed/i\nReceived string:  \"Validation Error\"","pass":false}}],"failureMessages":["Error: expect(received).toMatch(expected)\n\nExpected pattern: /validation failed/i\nReceived string:  \"Validation Error\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:386:39)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Figure Routes Integration POST /figures should handle comprehensive figure creation validation","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should handle comprehensive figure creation validation"},{"ancestorTitles":["Figure Routes Integration","POST /figures"],"duration":58,"failureDetails":[{}],"failureMessages":["Error: expected 201 \"Created\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:402:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration POST /figures should prevent duplicate figure creation","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should prevent duplicate figure creation"},{"ancestorTitles":["Figure Routes Integration","GET /figures/:id"],"duration":59,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures/:id should get figure by id successfully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should get figure by id successfully"},{"ancestorTitles":["Figure Routes Integration","GET /figures/:id"],"duration":59,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures/:id should return 404 for non-existent figure","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 404 for non-existent figure"},{"ancestorTitles":["Figure Routes Integration","GET /figures/:id"],"duration":110,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures/:id should return 404 for figure belonging to another user","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 404 for figure belonging to another user"},{"ancestorTitles":["Figure Routes Integration","PUT /figures/:id"],"duration":67,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration PUT /figures/:id should update figure successfully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should update figure successfully"},{"ancestorTitles":["Figure Routes Integration","PUT /figures/:id"],"duration":61,"failureDetails":[{}],"failureMessages":["Error: expected 404 \"Not Found\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:534:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration PUT /figures/:id should return 404 for non-existent figure","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return 404 for non-existent figure"},{"ancestorTitles":["Figure Routes Integration","DELETE /figures/:id"],"duration":62,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration DELETE /figures/:id should delete figure successfully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should delete figure successfully"},{"ancestorTitles":["Figure Routes Integration","DELETE /figures/:id"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration DELETE /figures/:id should return 404 for non-existent figure","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 404 for non-existent figure"},{"ancestorTitles":["Figure Routes Integration","GET /figures/search"],"duration":60,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures/search should return error when query parameter is missing","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error when query parameter is missing"},{"ancestorTitles":["Figure Routes Integration","GET /figures/search"],"duration":60,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:622:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/search should handle search query with Atlas Search mocking","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle search query with Atlas Search mocking"},{"ancestorTitles":["Figure Routes Integration","GET /figures/search"],"duration":61,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:663:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/search should handle complex Atlas Search scenarios","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle complex Atlas Search scenarios"},{"ancestorTitles":["Figure Routes Integration","GET /figures/search"],"duration":57,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:682:12)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/search should handle case-insensitive and partial Atlas Search","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle case-insensitive and partial Atlas Search"},{"ancestorTitles":["Figure Routes Integration","GET /figures/filter"],"duration":58,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:723:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/filter should filter figures by manufacturer","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should filter figures by manufacturer"},{"ancestorTitles":["Figure Routes Integration","GET /figures/filter"],"duration":59,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:736:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/filter should filter figures by scale","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should filter figures by scale"},{"ancestorTitles":["Figure Routes Integration","GET /figures/filter"],"duration":58,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:747:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/filter should filter figures by location","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should filter figures by location"},{"ancestorTitles":["Figure Routes Integration","GET /figures/filter"],"duration":60,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:760:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/filter should combine multiple filters","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should combine multiple filters"},{"ancestorTitles":["Figure Routes Integration","GET /figures/filter"],"duration":59,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:809:12)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/filter should handle advanced filtering scenarios","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle advanced filtering scenarios"},{"ancestorTitles":["Figure Routes Integration","GET /figures/filter"],"duration":58,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts:834:12)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Figure Routes Integration GET /figures/filter should handle filtering with no matching results","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle filtering with no matching results"},{"ancestorTitles":["Figure Routes Integration","GET /figures/stats"],"duration":63,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures/stats should return figure statistics","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return figure statistics"},{"ancestorTitles":["Figure Routes Integration","GET /figures/stats"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Figure Routes Integration GET /figures/stats should return 401 without authentication","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 401 without authentication"}],"endTime":1756365910098,"message":"  ● Figure Routes Integration › GET /figures › should handle advanced pagination scenarios\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: 4\n    Received: 3\n\n      184 |           .expect(200);\n      185 |\n    > 186 |         expect(response.body.count).toBe(scenario.expectedCount);\n          |                                     ^\n      187 |         expect(response.body.page).toBe(scenario.page);\n      188 |         expect(response.body.pages).toBe(scenario.expectedPages);\n      189 |         expect(response.body.data).toHaveLength(scenario.expectedCount);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:186:37)\n\n  ● Figure Routes Integration › GET /figures › should handle pagination edge cases\n\n    expected 400 \"Bad Request\", got 422 \"Unprocessable Entity\"\n\n      204 |           .get(`/figures?page=${scenario.page}&limit=${scenario.limit}`)\n      205 |           .set('Authorization', `Bearer ${authToken}`)\n    > 206 |           .expect(scenario.expectedStatus);\n          |            ^\n      207 |\n      208 |         if (scenario.expectedStatus === 400) {\n      209 |           expect(response.body.success).toBe(false);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:206:12)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › POST /figures › should create figure with MFC scraping\n\n    expected 201 \"Created\", got 422 \"Unprocessable Entity\"\n\n      312 |         .set('Authorization', `Bearer ${authToken}`)\n      313 |         .send(figureData)\n    > 314 |         .expect(201);\n          |          ^\n      315 |\n      316 |       expect(response.body.data.manufacturer).toBe('Good Smile Company');\n      317 |       expect(response.body.data.name).toBe('Hatsune Miku');\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:314:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › POST /figures › should handle comprehensive figure creation validation\n\n    expect(received).toMatch(expected)\n\n    Expected pattern: /validation failed/i\n    Received string:  \"Validation Error\"\n\n      384 |\n      385 |         expect(response.body.success).toBe(false);\n    > 386 |         expect(response.body.message).toMatch(scenario.expectedMessage);\n          |                                       ^\n      387 |       }\n      388 |     });\n      389 |\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:386:39)\n\n  ● Figure Routes Integration › POST /figures › should prevent duplicate figure creation\n\n    expected 201 \"Created\", got 422 \"Unprocessable Entity\"\n\n      400 |         .set('Authorization', `Bearer ${authToken}`)\n      401 |         .send(duplicateFigureData)\n    > 402 |         .expect(201);\n          |          ^\n      403 |\n      404 |       // Second creation with same unique identifier should fail\n      405 |       const secondResponse = await request(app)\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:402:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › PUT /figures/:id › should return 404 for non-existent figure\n\n    expected 404 \"Not Found\", got 422 \"Unprocessable Entity\"\n\n      532 |         .set('Authorization', `Bearer ${authToken}`)\n      533 |         .send({ name: 'Updated' })\n    > 534 |         .expect(404);\n          |          ^\n      535 |\n      536 |       expect(response.body).toEqual({\n      537 |         success: false,\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:534:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/search › should handle search query with Atlas Search mocking\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      620 |         .get('/figures/search?query=Miku')\n      621 |         .set('Authorization', `Bearer ${authToken}`)\n    > 622 |         .expect(200);\n          |          ^\n      623 |\n      624 |       expect(response.body.success).toBe(true);\n      625 |       expect(response.body.data).toHaveLength(1);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:622:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/search › should handle complex Atlas Search scenarios\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      661 |           .get(`/figures/search?query=${encodeURIComponent(scenario.query)}`)\n      662 |           .set('Authorization', `Bearer ${authToken}`)\n    > 663 |           .expect(200);\n          |            ^\n      664 |\n      665 |         expect(response.body.success).toBe(true);\n      666 |         expect(response.body.data).toHaveLength(scenario.expectedLength);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:663:12)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/search › should handle case-insensitive and partial Atlas Search\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      680 |           .get(`/figures/search?query=${encodeURIComponent(searchQuery.query)}`)\n      681 |           .set('Authorization', `Bearer ${authToken}`)\n    > 682 |           .expect(200);\n          |            ^\n      683 |\n      684 |         expect(response.body.success).toBe(true);\n      685 |         expect(response.body.data).toHaveLength(searchQuery.expectedLength);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:682:12)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/filter › should filter figures by manufacturer\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      721 |         .get('/figures/filter?manufacturer=Good Smile Company')\n      722 |         .set('Authorization', `Bearer ${authToken}`)\n    > 723 |         .expect(200);\n          |          ^\n      724 |\n      725 |       expect(response.body.success).toBe(true);\n      726 |       expect(response.body.total).toBe(2);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:723:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/filter › should filter figures by scale\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      734 |         .get('/figures/filter?scale=1/8')\n      735 |         .set('Authorization', `Bearer ${authToken}`)\n    > 736 |         .expect(200);\n          |          ^\n      737 |\n      738 |       expect(response.body.success).toBe(true);\n      739 |       expect(response.body.total).toBe(2);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:736:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/filter › should filter figures by location\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      745 |         .get('/figures/filter?location=Shelf A')\n      746 |         .set('Authorization', `Bearer ${authToken}`)\n    > 747 |         .expect(200);\n          |          ^\n      748 |\n      749 |       expect(response.body.success).toBe(true);\n      750 |       expect(response.body.total).toBe(2);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:747:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/filter › should combine multiple filters\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      758 |         .get('/figures/filter?manufacturer=Good Smile Company&scale=1/8')\n      759 |         .set('Authorization', `Bearer ${authToken}`)\n    > 760 |         .expect(200);\n          |          ^\n      761 |\n      762 |       expect(response.body.success).toBe(true);\n      763 |       expect(response.body.total).toBe(2);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:760:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/filter › should handle advanced filtering scenarios\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      807 |           .get(scenario.query)\n      808 |           .set('Authorization', `Bearer ${authToken}`)\n    > 809 |           .expect(200);\n          |            ^\n      810 |\n      811 |         expect(response.body.success).toBe(true);\n      812 |         expect(response.body.total).toBe(scenario.expectedTotal);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:809:12)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Figure Routes Integration › GET /figures/filter › should handle filtering with no matching results\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      832 |           .get(query)\n      833 |           .set('Authorization', `Bearer ${authToken}`)\n    > 834 |           .expect(200);\n          |            ^\n      835 |\n      836 |         expect(response.body.success).toBe(true);\n      837 |         expect(response.body.total).toBe(0);\n\n      at Object.<anonymous> (tests/integration/figureRoutes.test.ts:834:12)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/figureRoutes.test.ts","startTime":1756365907337,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Route Validation and Error Handling","Figure Routes Parameter Validation","GET /figures/:id"],"duration":168,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Figure Routes Parameter Validation GET /figures/:id should return 422 for invalid ObjectId format","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return 422 for invalid ObjectId format"},{"ancestorTitles":["Route Validation and Error Handling","Figure Routes Parameter Validation","GET /figures/:id"],"duration":62,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Figure Routes Parameter Validation GET /figures/:id should handle very long invalid IDs gracefully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle very long invalid IDs gracefully"},{"ancestorTitles":["Route Validation and Error Handling","Figure Routes Parameter Validation","GET /figures/:id"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Figure Routes Parameter Validation GET /figures/:id should handle special characters in ID parameter","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle special characters in ID parameter"},{"ancestorTitles":["Route Validation and Error Handling","Figure Routes Parameter Validation","PUT /figures/:id"],"duration":59,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Figure Routes Parameter Validation PUT /figures/:id should return 422 for invalid ObjectId in update","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return 422 for invalid ObjectId in update"},{"ancestorTitles":["Route Validation and Error Handling","Figure Routes Parameter Validation","DELETE /figures/:id"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Figure Routes Parameter Validation DELETE /figures/:id should return 422 for invalid ObjectId in delete","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return 422 for invalid ObjectId in delete"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /figures"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /figures should handle malformed JSON gracefully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle malformed JSON gracefully"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /figures"],"duration":59,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /figures should handle extremely long field values","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle extremely long field values"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /figures"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /figures should handle null values in optional fields","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle null values in optional fields"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /figures"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /figures should handle nested object attacks","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle nested object attacks"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /users/register"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /users/register should handle missing required fields gracefully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle missing required fields gracefully"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /users/register"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /users/register should handle extremely long username","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle extremely long username"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /users/register"],"duration":71,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /users/register should handle invalid email formats","invocations":1,"location":null,"numPassingAsserts":18,"retryReasons":[],"status":"passed","title":"should handle invalid email formats"},{"ancestorTitles":["Route Validation and Error Handling","Request Body Validation","POST /users/register"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Request Body Validation POST /users/register should handle SQL injection attempts in fields","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should handle SQL injection attempts in fields"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures with pagination"],"duration":77,"failureDetails":[{}],"failureMessages":["Error: expected 422 \"Unprocessable Entity\", got 200 \"OK\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routeValidation.test.ts:289:14)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures with pagination should handle invalid page numbers with validation error","invocations":1,"location":null,"numPassingAsserts":9,"retryReasons":[],"status":"failed","title":"should handle invalid page numbers with validation error"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures with pagination"],"duration":74,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures with pagination should handle invalid limit values with validation error","invocations":1,"location":null,"numPassingAsserts":15,"retryReasons":[],"status":"passed","title":"should handle invalid limit values with validation error"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures with pagination"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures with pagination should handle both invalid page and limit with validation error","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle both invalid page and limit with validation error"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures/search"],"duration":61,"failureDetails":[{}],"failureMessages":["Error: expected 400 \"Bad Request\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routeValidation.test.ts:329:12)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures/search should handle empty search query","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle empty search query"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures/search"],"duration":60,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 422\nReceived array: [200, 500]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 422\nReceived array: [200, 500]\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routeValidation.test.ts:343:28)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures/search should handle special characters in search query","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle special characters in search query"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures/search"],"duration":59,"failureDetails":[{"matcherResult":{"message":"expect(received).toContain(expected) // indexOf\n\nExpected value: 422\nReceived array: [200, 400, 500]","pass":false}}],"failureMessages":["Error: expect(received).toContain(expected) // indexOf\n\nExpected value: 422\nReceived array: [200, 400, 500]\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routeValidation.test.ts:353:33)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures/search should handle extremely long search queries","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle extremely long search queries"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures/filter"],"duration":61,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routeValidation.test.ts:370:14)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures/filter should handle regex injection attempts","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle regex injection attempts"},{"ancestorTitles":["Route Validation and Error Handling","Query Parameter Validation","GET /figures/filter"],"duration":61,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routeValidation.test.ts:383:12)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Route Validation and Error Handling Query Parameter Validation GET /figures/filter should handle URL encoded parameters","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle URL encoded parameters"},{"ancestorTitles":["Route Validation and Error Handling","Content-Type Handling"],"duration":57,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Content-Type Handling should handle unsupported content types","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle unsupported content types"},{"ancestorTitles":["Route Validation and Error Handling","Content-Type Handling"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Content-Type Handling should handle XML content type","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle XML content type"},{"ancestorTitles":["Route Validation and Error Handling","Header Validation"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Header Validation should handle missing Authorization header","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle missing Authorization header"},{"ancestorTitles":["Route Validation and Error Handling","Header Validation"],"duration":69,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Header Validation should handle malformed Authorization header","invocations":1,"location":null,"numPassingAsserts":15,"retryReasons":[],"status":"passed","title":"should handle malformed Authorization header"},{"ancestorTitles":["Route Validation and Error Handling","Header Validation"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Header Validation should handle extremely long Authorization header","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle extremely long Authorization header"},{"ancestorTitles":["Route Validation and Error Handling","Rate Limiting and Large Payloads"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Rate Limiting and Large Payloads should handle large JSON payloads","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle large JSON payloads"},{"ancestorTitles":["Route Validation and Error Handling","Error Response Consistency"],"duration":69,"failureDetails":[],"failureMessages":[],"fullName":"Route Validation and Error Handling Error Response Consistency should return consistent error format across endpoints","invocations":1,"location":null,"numPassingAsserts":16,"retryReasons":[],"status":"passed","title":"should return consistent error format across endpoints"}],"endTime":1756365912399,"message":"  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures with pagination › should handle invalid page numbers with validation error\n\n    expected 422 \"Unprocessable Entity\", got 200 \"OK\"\n\n      287 |             .get(`/figures?page=${page}`)\n      288 |             .set('Authorization', `Bearer ${authToken}`)\n    > 289 |             .expect(422);\n          |              ^\n      290 |           \n      291 |           expect(response.body.success).toBe(false);\n      292 |           expect(response.body.message).toBe('Validation Error');\n\n      at Object.<anonymous> (tests/integration/routeValidation.test.ts:289:14)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/search › should handle empty search query\n\n    expected 400 \"Bad Request\", got 422 \"Unprocessable Entity\"\n\n      327 |           .get('/figures/search?query=')\n      328 |           .set('Authorization', `Bearer ${authToken}`)\n    > 329 |           .expect(400);\n          |            ^\n      330 |\n      331 |         expect(response.body.success).toBe(false);\n      332 |         expect(response.body.message).toBe('Search query is required');\n\n      at Object.<anonymous> (tests/integration/routeValidation.test.ts:329:12)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/search › should handle special characters in search query\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 422\n    Received array: [200, 500]\n\n      341 |\n      342 |         // Should handle gracefully (may succeed or fail based on Atlas Search availability)\n    > 343 |         expect([200, 500]).toContain(response.status);\n          |                            ^\n      344 |       });\n      345 |\n      346 |       it('should handle extremely long search queries', async () => {\n\n      at Object.<anonymous> (tests/integration/routeValidation.test.ts:343:28)\n\n  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/search › should handle extremely long search queries\n\n    expect(received).toContain(expected) // indexOf\n\n    Expected value: 422\n    Received array: [200, 400, 500]\n\n      351 |           .set('Authorization', `Bearer ${authToken}`);\n      352 |\n    > 353 |         expect([200, 400, 500]).toContain(response.status);\n          |                                 ^\n      354 |       });\n      355 |     });\n      356 |\n\n      at Object.<anonymous> (tests/integration/routeValidation.test.ts:353:33)\n\n  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/filter › should handle regex injection attempts\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      368 |             .get(`/figures/filter?${filter}`)\n      369 |             .set('Authorization', `Bearer ${authToken}`)\n    > 370 |             .expect(200);\n          |              ^\n      371 |\n      372 |           expect(response.body.success).toBe(true);\n      373 |           // Should handle regex patterns safely\n\n      at Object.<anonymous> (tests/integration/routeValidation.test.ts:370:14)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Route Validation and Error Handling › Query Parameter Validation › GET /figures/filter › should handle URL encoded parameters\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      381 |           .get(`/figures/filter?manufacturer=${encodedManufacturer}`)\n      382 |           .set('Authorization', `Bearer ${authToken}`)\n    > 383 |           .expect(200);\n          |            ^\n      384 |\n      385 |         expect(response.body.success).toBe(true);\n      386 |       });\n\n      at Object.<anonymous> (tests/integration/routeValidation.test.ts:383:12)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routeValidation.test.ts","startTime":1756365910100,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["User Routes Integration","POST /users/register"],"duration":140,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration POST /users/register should register a new user successfully","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should register a new user successfully"},{"ancestorTitles":["User Routes Integration","POST /users/register"],"duration":15,"failureDetails":[{}],"failureMessages":["Error: expected 500 \"Internal Server Error\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:51:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration POST /users/register should return error for missing required fields","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return error for missing required fields"},{"ancestorTitles":["User Routes Integration","POST /users/register"],"duration":64,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration POST /users/register should return error for duplicate username","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error for duplicate username"},{"ancestorTitles":["User Routes Integration","POST /users/register"],"duration":65,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration POST /users/register should return error for duplicate email","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error for duplicate email"},{"ancestorTitles":["User Routes Integration","POST /users/register"],"duration":9,"failureDetails":[{}],"failureMessages":["Error: expected 500 \"Internal Server Error\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:129:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration POST /users/register should handle invalid email format","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle invalid email format"},{"ancestorTitles":["User Routes Integration","POST /users/login"],"duration":55,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:157:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration POST /users/login should login successfully with correct credentials","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should login successfully with correct credentials"},{"ancestorTitles":["User Routes Integration","POST /users/login"],"duration":56,"failureDetails":[{}],"failureMessages":["Error: expected 401 \"Unauthorized\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:180:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration POST /users/login should return error for incorrect email","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return error for incorrect email"},{"ancestorTitles":["User Routes Integration","POST /users/login"],"duration":58,"failureDetails":[{}],"failureMessages":["Error: expected 401 \"Unauthorized\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:197:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration POST /users/login should return error for incorrect password","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return error for incorrect password"},{"ancestorTitles":["User Routes Integration","POST /users/login"],"duration":56,"failureDetails":[{}],"failureMessages":["Error: expected 401 \"Unauthorized\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:209:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration POST /users/login should return error for missing credentials","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return error for missing credentials"},{"ancestorTitles":["User Routes Integration","POST /users/login"],"duration":102,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:231:10)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration POST /users/login should login admin user successfully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should login admin user successfully"},{"ancestorTitles":["User Routes Integration","GET /users/profile"],"duration":60,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration GET /users/profile should get user profile with valid token","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should get user profile with valid token"},{"ancestorTitles":["User Routes Integration","GET /users/profile"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration GET /users/profile should return 401 without token","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 401 without token"},{"ancestorTitles":["User Routes Integration","GET /users/profile"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration GET /users/profile should return 401 with invalid token","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 401 with invalid token"},{"ancestorTitles":["User Routes Integration","GET /users/profile"],"duration":60,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration GET /users/profile should return 404 if user no longer exists","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 404 if user no longer exists"},{"ancestorTitles":["User Routes Integration","PUT /users/profile"],"duration":63,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration PUT /users/profile should update user profile successfully","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should update user profile successfully"},{"ancestorTitles":["User Routes Integration","PUT /users/profile"],"duration":57,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:361:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration PUT /users/profile should update password successfully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should update password successfully"},{"ancestorTitles":["User Routes Integration","PUT /users/profile"],"duration":58,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:385:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration PUT /users/profile should update only provided fields","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should update only provided fields"},{"ancestorTitles":["User Routes Integration","PUT /users/profile"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"User Routes Integration PUT /users/profile should return 401 without token","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return 401 without token"},{"ancestorTitles":["User Routes Integration","PUT /users/profile"],"duration":57,"failureDetails":[{}],"failureMessages":["Error: expected 404 \"Not Found\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:419:10)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration PUT /users/profile should return 404 if user no longer exists","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return 404 if user no longer exists"},{"ancestorTitles":["User Routes Integration","Authentication Flow Integration"],"duration":64,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts:455:10)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"User Routes Integration Authentication Flow Integration should complete full registration and login flow","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should complete full registration and login flow"}],"endTime":1756365914136,"message":"  ● User Routes Integration › POST /users/register › should return error for missing required fields\n\n    expected 500 \"Internal Server Error\", got 422 \"Unprocessable Entity\"\n\n      49 |         .post('/users/register')\n      50 |         .send(incompleteData)\n    > 51 |         .expect(500);\n         |          ^\n      52 |\n      53 |       expect(response.body.success).toBe(false);\n      54 |       expect(response.body.message).toBe('Server Error');\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:51:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › POST /users/register › should handle invalid email format\n\n    expected 500 \"Internal Server Error\", got 422 \"Unprocessable Entity\"\n\n      127 |         .post('/users/register')\n      128 |         .send(userData)\n    > 129 |         .expect(500);\n          |          ^\n      130 |\n      131 |       expect(response.body.success).toBe(false);\n      132 |     });\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:129:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › POST /users/login › should login successfully with correct credentials\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      155 |         .post('/users/login')\n      156 |         .send(loginData)\n    > 157 |         .expect(200);\n          |          ^\n      158 |\n      159 |       expect(response.body).toEqual({\n      160 |         success: true,\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:157:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › POST /users/login › should return error for incorrect email\n\n    expected 401 \"Unauthorized\", got 422 \"Unprocessable Entity\"\n\n      178 |         .post('/users/login')\n      179 |         .send(loginData)\n    > 180 |         .expect(401);\n          |          ^\n      181 |\n      182 |       expect(response.body).toEqual({\n      183 |         success: false,\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:180:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › POST /users/login › should return error for incorrect password\n\n    expected 401 \"Unauthorized\", got 422 \"Unprocessable Entity\"\n\n      195 |         .post('/users/login')\n      196 |         .send(loginData)\n    > 197 |         .expect(401);\n          |          ^\n      198 |\n      199 |       expect(response.body).toEqual({\n      200 |         success: false,\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:197:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › POST /users/login › should return error for missing credentials\n\n    expected 401 \"Unauthorized\", got 422 \"Unprocessable Entity\"\n\n      207 |         .post('/users/login')\n      208 |         .send({})\n    > 209 |         .expect(401);\n          |          ^\n      210 |\n      211 |       expect(response.body.success).toBe(false);\n      212 |     });\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:209:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › POST /users/login › should login admin user successfully\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      229 |         .post('/users/login')\n      230 |         .send(loginData)\n    > 231 |         .expect(200);\n          |          ^\n      232 |\n      233 |       expect(response.body.data.isAdmin).toBe(true);\n      234 |     });\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:231:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › PUT /users/profile › should update password successfully\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      359 |         .set('Authorization', `Bearer ${authToken}`)\n      360 |         .send(updateData)\n    > 361 |         .expect(200);\n          |          ^\n      362 |\n      363 |       expect(response.body.success).toBe(true);\n      364 |\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:361:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › PUT /users/profile › should update only provided fields\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      383 |         .set('Authorization', `Bearer ${authToken}`)\n      384 |         .send(updateData)\n    > 385 |         .expect(200);\n          |          ^\n      386 |\n      387 |       expect(response.body.data.username).toBe(originalUsername);\n      388 |       expect(response.body.data.email).toBe('newemail@example.com');\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:385:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › PUT /users/profile › should return 404 if user no longer exists\n\n    expected 404 \"Not Found\", got 422 \"Unprocessable Entity\"\n\n      417 |         .set('Authorization', `Bearer ${authToken}`)\n      418 |         .send(updateData)\n    > 419 |         .expect(404);\n          |          ^\n      420 |\n      421 |       expect(response.body).toEqual({\n      422 |         success: false,\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:419:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● User Routes Integration › Authentication Flow Integration › should complete full registration and login flow\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      453 |         .post('/users/login')\n      454 |         .send(loginData)\n    > 455 |         .expect(200);\n          |          ^\n      456 |\n      457 |       expect(loginResponse.body.success).toBe(true);\n      458 |       expect(loginResponse.body.data._id).toBe(userId);\n\n      at Object.<anonymous> (tests/integration/userRoutes.test.ts:455:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/userRoutes.test.ts","startTime":1756365912402,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Atlas Search Integration Tests","Atlas Search Mock Functionality"],"duration":181,"failureDetails":[{}],"failureMessages":["TypeError: (0 , setup_1.mockAtlasSearch) is not a function\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/atlasSearch.test.ts:69:36)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Atlas Search Integration Tests Atlas Search Mock Functionality should test mock Atlas Search function directly","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should test mock Atlas Search function directly"},{"ancestorTitles":["Atlas Search Integration Tests","Atlas Search Mock Functionality"],"duration":61,"failureDetails":[{}],"failureMessages":["TypeError: (0 , setup_1.getTestMode) is not a function\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/atlasSearch.test.ts:95:35)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Atlas Search Integration Tests Atlas Search Mock Functionality should perform search via API endpoint with mocked Atlas Search","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should perform search via API endpoint with mocked Atlas Search"},{"ancestorTitles":["Atlas Search Integration Tests","Atlas Search Mock Functionality"],"duration":116,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/atlasSearch.test.ts:143:10)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Atlas Search Integration Tests Atlas Search Mock Functionality should ensure user isolation in search results","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should ensure user isolation in search results"},{"ancestorTitles":["Atlas Search Integration Tests","Atlas Search Mock Functionality"],"duration":60,"failureDetails":[{}],"failureMessages":["Error: expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/atlasSearch.test.ts:156:10)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)\n----\n    at Test._assertStatus (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:252:14)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:308:13\n    at Test._assertFunction (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:285:13)\n    at Test.assert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:164:23)\n    at Server.localAssert (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/supertest/lib/test.js:120:14)\n    at Object.onceWrapper (node:events:621:28)\n    at Server.emit (node:events:507:28)\n    at emitCloseNT (node:net:2419:8)\n    at processTicksAndRejections (node:internal/process/task_queues:89:21)"],"fullName":"Atlas Search Integration Tests Atlas Search Mock Functionality should handle empty search results","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle empty search results"},{"ancestorTitles":["Atlas Search Integration Tests","Atlas Search Mock Functionality"],"duration":61,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Integration Tests Atlas Search Mock Functionality should validate search query parameter","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should validate search query parameter"},{"ancestorTitles":["Atlas Search Integration Tests","Atlas Search Mock Functionality"],"duration":59,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Integration Tests Atlas Search Mock Functionality should require authentication for search","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require authentication for search"}],"endTime":1756365915158,"message":"  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should test mock Atlas Search function directly\n\n    TypeError: (0 , setup_1.mockAtlasSearch) is not a function\n\n      67 |       \n      68 |       // Test exact match\n    > 69 |       let results = mockAtlasSearch('Miku', allFigures, testUser._id);\n         |                                    ^\n      70 |       expect(results).toHaveLength(1);\n      71 |       expect(results[0].name).toBe('Hatsune Miku');\n      72 |       \n\n      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:69:36)\n\n  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should perform search via API endpoint with mocked Atlas Search\n\n    TypeError: (0 , setup_1.getTestMode) is not a function\n\n      93 |\n      94 |     it('should perform search via API endpoint with mocked Atlas Search', async () => {\n    > 95 |       const testMode = getTestMode();\n         |                                   ^\n      96 |       const usingRealAtlas = isUsingRealAtlasSearch();\n      97 |       console.log('Running test in ' + testMode + ' mode, using real Atlas: ' + usingRealAtlas);\n      98 |       \n\n      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:95:35)\n\n  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should ensure user isolation in search results\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      141 |         .get('/figures/search?query=Good Smile Company')\n      142 |         .set('Authorization', 'Bearer ' + authToken)\n    > 143 |         .expect(200);\n          |          ^\n      144 |\n      145 |       expect(response.body.success).toBe(true);\n      146 |       expect(response.body.data).toHaveLength(2); // Only original user's figures\n\n      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:143:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n\n  ● Atlas Search Integration Tests › Atlas Search Mock Functionality › should handle empty search results\n\n    expected 200 \"OK\", got 422 \"Unprocessable Entity\"\n\n      154 |         .get('/figures/search?query=NonexistentTerm')\n      155 |         .set('Authorization', 'Bearer ' + authToken)\n    > 156 |         .expect(200);\n          |          ^\n      157 |\n      158 |       expect(response.body.success).toBe(true);\n      159 |       expect(response.body.data).toHaveLength(0);\n\n      at Object.<anonymous> (tests/integration/atlasSearch.test.ts:156:10)\n      ----\n      at Test._assertStatus (node_modules/supertest/lib/test.js:252:14)\n      at node_modules/supertest/lib/test.js:308:13\n      at Test._assertFunction (node_modules/supertest/lib/test.js:285:13)\n      at Test.assert (node_modules/supertest/lib/test.js:164:23)\n      at Server.localAssert (node_modules/supertest/lib/test.js:120:14)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/atlasSearch.test.ts","startTime":1756365914138,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Service Endpoints Integration","GET /health"],"duration":26,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration GET /health should return health check status","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return health check status"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service"],"duration":112,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service should register frontend service successfully","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should register frontend service successfully"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service should register frontend service with minimal data","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should register frontend service with minimal data"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service should return error for missing serviceName","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error for missing serviceName"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service should return error for missing version","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error for missing version"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service should return error for unsupported service","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return error for unsupported service"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service should handle empty request body","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle empty request body"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service should handle malformed JSON","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle malformed JSON"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service","Service name handling"],"duration":9,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service Service name handling should use provided service name","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should use provided service name"},{"ancestorTitles":["Service Endpoints Integration","POST /register-service","Service name handling"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration POST /register-service Service name handling should use default name if not provided","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should use default name if not provided"},{"ancestorTitles":["Service Endpoints Integration","GET /version"],"duration":9,"failureDetails":[{"matcherResult":{"actual":{"application":{"name":"figure-collector-services","version":"1.0.0-test","releaseDate":"2024-01-01"},"services":{"backend":{"name":"figure-collector-backend","version":"1.0.0-test","status":"ok"},"frontend":{"name":"figure-collector-frontend","version":"1.0.0","status":"ok"},"scraper":{"name":"page-scraper","version":"unknown","status":"not-checked"}}},"expected":{"application":{"name":"figure-collector-services","version":"1.0.0-test","releaseDate":"2024-01-01"},"services":{"backend":{"name":"figure-collector-backend","version":"1.0.0-test","status":"ok"},"frontend":{"name":"figure-collector-frontend","version":"unknown","status":"not-registered"},"scraper":{"name":"page-scraper","version":"unknown","status":"not-checked"}}},"message":"expect(received).toEqual(expected) // deep equality\n\n- Expected  - 2\n+ Received  + 2\n\n@@ -10,12 +10,12 @@\n        \"status\": \"ok\",\n        \"version\": \"1.0.0-test\",\n      },\n      \"frontend\": Object {\n        \"name\": \"figure-collector-frontend\",\n-       \"status\": \"not-registered\",\n-       \"version\": \"unknown\",\n+       \"status\": \"ok\",\n+       \"version\": \"1.0.0\",\n      },\n      \"scraper\": Object {\n        \"name\": \"page-scraper\",\n        \"status\": \"not-checked\",\n        \"version\": \"unknown\",","name":"toEqual","pass":false}}],"failureMessages":["Error: expect(received).toEqual(expected) // deep equality\n\n- Expected  - 2\n+ Received  + 2\n\n@@ -10,12 +10,12 @@\n        \"status\": \"ok\",\n        \"version\": \"1.0.0-test\",\n      },\n      \"frontend\": Object {\n        \"name\": \"figure-collector-frontend\",\n-       \"status\": \"not-registered\",\n-       \"version\": \"unknown\",\n+       \"status\": \"ok\",\n+       \"version\": \"1.0.0\",\n      },\n      \"scraper\": Object {\n        \"name\": \"page-scraper\",\n        \"status\": \"not-checked\",\n        \"version\": \"unknown\",\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/serviceEndpoints.test.ts:171:29)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Service Endpoints Integration GET /version should return version information with default values","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return version information with default values"},{"ancestorTitles":["Service Endpoints Integration","GET /version"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration GET /version should reflect registered frontend service","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should reflect registered frontend service"},{"ancestorTitles":["Service Endpoints Integration","GET /version"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration GET /version should maintain service state across multiple requests","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"should maintain service state across multiple requests"},{"ancestorTitles":["Service Endpoints Integration","GET /version"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration GET /version should handle version updates","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle version updates"},{"ancestorTitles":["Service Endpoints Integration","GET /version","Version format validation"],"duration":25,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration GET /version Version format validation should handle semantic versions","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should handle semantic versions"},{"ancestorTitles":["Service Endpoints Integration","GET /version","Version format validation"],"duration":27,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration GET /version Version format validation should handle non-semantic versions","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should handle non-semantic versions"},{"ancestorTitles":["Service Endpoints Integration","GET /version","Version format validation"],"duration":9,"failureDetails":[{"matcherResult":{"actual":"build-123","expected":"","message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: \"\"\nReceived: \"build-123\"","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"\"\nReceived: \"build-123\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/serviceEndpoints.test.ts:321:57)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Service Endpoints Integration GET /version Version format validation should handle empty version string","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle empty version string"},{"ancestorTitles":["Service Endpoints Integration","Service Registration and Version Flow"],"duration":7,"failureDetails":[{"matcherResult":{"actual":"ok","expected":"not-registered","message":"expect(received).toBe(expected) // Object.is equality\n\nExpected: \"not-registered\"\nReceived: \"ok\"","name":"toBe","pass":false}}],"failureMessages":["Error: expect(received).toBe(expected) // Object.is equality\n\nExpected: \"not-registered\"\nReceived: \"ok\"\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/serviceEndpoints.test.ts:334:61)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Service Endpoints Integration Service Registration and Version Flow should complete full service registration flow","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should complete full service registration flow"},{"ancestorTitles":["Service Endpoints Integration","Service Registration and Version Flow"],"duration":23,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration Service Registration and Version Flow should handle multiple rapid registrations","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle multiple rapid registrations"},{"ancestorTitles":["Service Endpoints Integration","Error Handling"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration Error Handling should handle version endpoint errors gracefully","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle version endpoint errors gracefully"},{"ancestorTitles":["Service Endpoints Integration","Error Handling"],"duration":15,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration Error Handling should handle service registration errors gracefully","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should handle service registration errors gracefully"},{"ancestorTitles":["Service Endpoints Integration","Content-Type Handling"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration Content-Type Handling should handle application/json content type","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle application/json content type"},{"ancestorTitles":["Service Endpoints Integration","Content-Type Handling"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration Content-Type Handling should handle form-encoded data","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle form-encoded data"},{"ancestorTitles":["Service Endpoints Integration","Content-Type Handling"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Service Endpoints Integration Content-Type Handling should handle missing content-type","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle missing content-type"}],"endTime":1756365916067,"message":"  ● Service Endpoints Integration › GET /version › should return version information with default values\n\n    expect(received).toEqual(expected) // deep equality\n\n    - Expected  - 2\n    + Received  + 2\n\n    @@ -10,12 +10,12 @@\n            \"status\": \"ok\",\n            \"version\": \"1.0.0-test\",\n          },\n          \"frontend\": Object {\n            \"name\": \"figure-collector-frontend\",\n    -       \"status\": \"not-registered\",\n    -       \"version\": \"unknown\",\n    +       \"status\": \"ok\",\n    +       \"version\": \"1.0.0\",\n          },\n          \"scraper\": Object {\n            \"name\": \"page-scraper\",\n            \"status\": \"not-checked\",\n            \"version\": \"unknown\",\n\n      169 |         .expect(200);\n      170 |\n    > 171 |       expect(response.body).toEqual({\n          |                             ^\n      172 |         application: {\n      173 |           name: 'figure-collector-services',\n      174 |           version: '1.0.0-test',\n\n      at Object.<anonymous> (tests/integration/serviceEndpoints.test.ts:171:29)\n\n  ● Service Endpoints Integration › GET /version › Version format validation › should handle empty version string\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"\"\n    Received: \"build-123\"\n\n      319 |           .expect(200);\n      320 |\n    > 321 |         expect(response.body.services.frontend.version).toBe('');\n          |                                                         ^\n      322 |         expect(response.body.services.frontend.status).toBe('ok');\n      323 |       });\n      324 |     });\n\n      at Object.<anonymous> (tests/integration/serviceEndpoints.test.ts:321:57)\n\n  ● Service Endpoints Integration › Service Registration and Version Flow › should complete full service registration flow\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"not-registered\"\n    Received: \"ok\"\n\n      332 |         .expect(200);\n      333 |\n    > 334 |       expect(versionResponse.body.services.frontend.status).toBe('not-registered');\n          |                                                             ^\n      335 |       expect(versionResponse.body.services.frontend.version).toBe('unknown');\n      336 |\n      337 |       // Register service\n\n      at Object.<anonymous> (tests/integration/serviceEndpoints.test.ts:334:61)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/serviceEndpoints.test.ts","startTime":1756365915160,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Figure Routes Integration","POST /figures/scrape-mfc"],"duration":23,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration POST /figures/scrape-mfc should scrape MFC data successfully (public endpoint)","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should scrape MFC data successfully (public endpoint)"},{"ancestorTitles":["Figure Routes Integration","POST /figures/scrape-mfc"],"duration":10,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration POST /figures/scrape-mfc should return error for invalid MFC URL","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return error for invalid MFC URL"},{"ancestorTitles":["Figure Routes Integration","POST /figures/scrape-mfc"],"duration":5,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration POST /figures/scrape-mfc should return error for missing MFC link","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return error for missing MFC link"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":5,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration GET /figures should get user figures with authentication","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should get user figures with authentication"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":7,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration GET /figures should support pagination","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should support pagination"},{"ancestorTitles":["Figure Routes Integration","GET /figures"],"duration":11,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration GET /figures should return 401 without authentication","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return 401 without authentication"},{"ancestorTitles":["Figure Routes Integration","POST /figures"],"duration":6,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration POST /figures should create figure successfully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should create figure successfully"},{"ancestorTitles":["Figure Routes Integration","POST /figures"],"duration":4,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration POST /figures should return 401 without authentication","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return 401 without authentication"},{"ancestorTitles":["Figure Routes Integration","GET /figures/search"],"duration":5,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration GET /figures/search should handle search query","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle search query"},{"ancestorTitles":["Figure Routes Integration","GET /figures/filter"],"duration":4,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration GET /figures/filter should filter figures by manufacturer","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should filter figures by manufacturer"},{"ancestorTitles":["Figure Routes Integration","GET /figures/stats"],"duration":4,"failureDetails":[{"errors":{"userId":{"properties":{"message":"Path `userId` is required.","type":"required","path":"userId"},"kind":"required","path":"userId"}},"_message":"Figure validation failed"}],"failureMessages":["ValidationError: Figure validation failed: userId: Path `userId` is required.\n    at model.Object.<anonymous>.Document.invalidate (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3219:32)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/document.js:3012:17\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/schematype.js:1368:9\n    at processTicksAndRejections (node:internal/process/task_queues:85:11)"],"fullName":"Figure Routes Integration GET /figures/stats should return figure statistics","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return figure statistics"}],"endTime":1756365917161,"message":"  ● Figure Routes Integration › POST /figures/scrape-mfc › should scrape MFC data successfully (public endpoint)\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › POST /figures/scrape-mfc › should return error for invalid MFC URL\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › POST /figures/scrape-mfc › should return error for missing MFC link\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › GET /figures › should get user figures with authentication\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › GET /figures › should support pagination\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › GET /figures › should return 401 without authentication\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › POST /figures › should create figure successfully\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › POST /figures › should return 401 without authentication\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › GET /figures/search › should handle search query\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › GET /figures/filter › should filter figures by manufacturer\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n\n  ● Figure Routes Integration › GET /figures/stats › should return figure statistics\n\n    ValidationError: Figure validation failed: userId: Path `userId` is required.\n\n      at model.Object.<anonymous>.Document.invalidate (node_modules/mongoose/lib/document.js:3219:32)\n      at node_modules/mongoose/lib/document.js:3012:17\n      at node_modules/mongoose/lib/schematype.js:1368:9\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/routes/figureRoutes.test.ts","startTime":1756365916070,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["FigureController","getFigures"],"duration":14,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigures should get figures with default pagination","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"should get figures with default pagination"},{"ancestorTitles":["FigureController","getFigures"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigures should handle pagination parameters","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle pagination parameters"},{"ancestorTitles":["FigureController","getFigures"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigures should handle server errors","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle server errors"},{"ancestorTitles":["FigureController","getFigureById"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigureById should get figure by id successfully","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should get figure by id successfully"},{"ancestorTitles":["FigureController","getFigureById"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigureById should return 404 if figure not found","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return 404 if figure not found"},{"ancestorTitles":["FigureController","createFigure"],"duration":77,"failureDetails":[],"failureMessages":[],"fullName":"FigureController createFigure should create figure successfully without scraping","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should create figure successfully without scraping"},{"ancestorTitles":["FigureController","createFigure"],"duration":17,"failureDetails":[],"failureMessages":[],"fullName":"FigureController createFigure should create figure with MFC scraping","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should create figure with MFC scraping"},{"ancestorTitles":["FigureController","createFigure"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"FigureController createFigure should handle scraping service failure with fallback","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle scraping service failure with fallback"},{"ancestorTitles":["FigureController","updateFigure"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController updateFigure should update figure successfully","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should update figure successfully"},{"ancestorTitles":["FigureController","updateFigure"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController updateFigure should return 404 if figure not found","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return 404 if figure not found"},{"ancestorTitles":["FigureController","deleteFigure"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"FigureController deleteFigure should delete figure successfully","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should delete figure successfully"},{"ancestorTitles":["FigureController","deleteFigure"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"FigureController deleteFigure should return 404 if figure not found","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return 404 if figure not found"},{"ancestorTitles":["FigureController","scrapeMFCData"],"duration":8,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 500\nReceived: 200\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 500\nReceived: 200\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:425:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"FigureController scrapeMFCData should handle scraper service network errors","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle scraper service network errors"},{"ancestorTitles":["FigureController","scrapeMFCData"],"duration":5,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 422\nReceived: 200\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 422\nReceived: 200\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:448:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"FigureController scrapeMFCData should handle invalid data from scraper service","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle invalid data from scraper service"},{"ancestorTitles":["FigureController","scrapeMFCData"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"FigureController scrapeMFCData should scrape MFC data successfully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should scrape MFC data successfully"},{"ancestorTitles":["FigureController","scrapeMFCData"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"FigureController scrapeMFCData should return error for missing MFC link","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error for missing MFC link"},{"ancestorTitles":["FigureController","scrapeMFCData"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"FigureController scrapeMFCData should return error for invalid URL","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error for invalid URL"},{"ancestorTitles":["FigureController","scrapeMFCData"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"FigureController scrapeMFCData should return error for non-MFC URL","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error for non-MFC URL"},{"ancestorTitles":["FigureController","searchFigures"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController searchFigures should handle database errors during search","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle database errors during search"},{"ancestorTitles":["FigureController","searchFigures"],"duration":4,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  Object {\n-   \"message\": \"Search query is too short or invalid\",\n+   \"message\": \"Search query is required\",\n    \"success\": false,\n  },\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  Object {\n-   \"message\": \"Search query is too short or invalid\",\n+   \"message\": \"Search query is required\",\n    \"success\": false,\n  },\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:551:33)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"FigureController searchFigures should handle invalid search query formats","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should handle invalid search query formats"},{"ancestorTitles":["FigureController","searchFigures"],"duration":4,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 400\nReceived: 500\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 400\nReceived: 500\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:562:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"FigureController searchFigures should handle search with very long query","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle search with very long query"},{"ancestorTitles":["FigureController","searchFigures"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController searchFigures should search figures using MongoDB Atlas Search with comprehensive mocking","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"passed","title":"should search figures using MongoDB Atlas Search with comprehensive mocking"},{"ancestorTitles":["FigureController","searchFigures"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"FigureController searchFigures should return error if query parameter is missing","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error if query parameter is missing"},{"ancestorTitles":["FigureController","filterFigures"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"FigureController filterFigures should filter figures with multiple criteria","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should filter figures with multiple criteria"},{"ancestorTitles":["FigureController","getFigureStats"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigureStats should return figure statistics","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return figure statistics"},{"ancestorTitles":["FigureController","getFigureStats"],"duration":28,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigureStats should handle invalid user ID during stats retrieval","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle invalid user ID during stats retrieval"},{"ancestorTitles":["FigureController","getFigureStats"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController getFigureStats should handle database errors during statistics calculation","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle database errors during statistics calculation"},{"ancestorTitles":["FigureController","Local MFC Scraping Fallback Scenarios"],"duration":6,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 500\nReceived: 200\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 500\nReceived: 200\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:769:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"FigureController Local MFC Scraping Fallback Scenarios should handle local fallback when scraper service fails completely","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle local fallback when scraper service fails completely"},{"ancestorTitles":["FigureController","Local MFC Scraping Fallback Scenarios"],"duration":7,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 500\nReceived: 200\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: 500\nReceived: 200\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:799:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"FigureController Local MFC Scraping Fallback Scenarios should handle Cloudflare challenge detection during scraping","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle Cloudflare challenge detection during scraping"},{"ancestorTitles":["FigureController","Local MFC Scraping Fallback Scenarios"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"FigureController Local MFC Scraping Fallback Scenarios should handle manual extraction when all scraping methods fail","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle manual extraction when all scraping methods fail"},{"ancestorTitles":["FigureController","Advanced Error Handling Scenarios"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"FigureController Advanced Error Handling Scenarios should handle invalid or blocked scraper with manual extraction marker","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle invalid or blocked scraper with manual extraction marker"},{"ancestorTitles":["FigureController","Advanced Error Handling Scenarios"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"FigureController Advanced Error Handling Scenarios should handle non-string input during MFC data scraping","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle non-string input during MFC data scraping"},{"ancestorTitles":["FigureController","Advanced Error Handling Scenarios"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"FigureController Advanced Error Handling Scenarios should handle empty manufacturer name during figure creation","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle empty manufacturer name during figure creation"},{"ancestorTitles":["FigureController","Advanced Error Handling Scenarios"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"FigureController Advanced Error Handling Scenarios should handle server errors during figure creation","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle server errors during figure creation"},{"ancestorTitles":["FigureController","Advanced Error Handling Scenarios"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"imageUrl\": \"https://example.com/detailed-image.jpg\", \"manufacturer\": \"Complete Manufacturer\", \"name\": \"Complete Name\", \"scale\": \"1/8\"}\nReceived: {\"boxNumber\": \"\", \"imageUrl\": \"https://example.com/detailed-image.jpg\", \"location\": \"\", \"manufacturer\": \"Partial Manufacturer\", \"mfcLink\": \"https://myfigurecollection.net/item/12345\", \"name\": \"Complete Name\", \"scale\": \"1/8\", \"userId\": \"000000000000000000000123\"}\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: ObjectContaining {\"imageUrl\": \"https://example.com/detailed-image.jpg\", \"manufacturer\": \"Complete Manufacturer\", \"name\": \"Complete Name\", \"scale\": \"1/8\"}\nReceived: {\"boxNumber\": \"\", \"imageUrl\": \"https://example.com/detailed-image.jpg\", \"location\": \"\", \"manufacturer\": \"Partial Manufacturer\", \"mfcLink\": \"https://myfigurecollection.net/item/12345\", \"name\": \"Complete Name\", \"scale\": \"1/8\", \"userId\": \"000000000000000000000123\"}\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts:970:35)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"FigureController Advanced Error Handling Scenarios should handle complex scraping data merging scenarios","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle complex scraping data merging scenarios"}],"endTime":1756365917896,"message":"  ● FigureController › scrapeMFCData › should handle scraper service network errors\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 500\n    Received: 200\n\n    Number of calls: 1\n\n      423 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);\n      424 |\n    > 425 |       expect(mockResponse.status).toHaveBeenCalledWith(500);\n          |                                   ^\n      426 |       expect(mockResponse.json).toHaveBeenCalledWith({\n      427 |         success: false,\n      428 |         message: 'Failed to scrape MFC data',\n\n      at Object.<anonymous> (tests/controllers/figureController.test.ts:425:35)\n\n  ● FigureController › scrapeMFCData › should handle invalid data from scraper service\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 422\n    Received: 200\n\n    Number of calls: 1\n\n      446 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);\n      447 |\n    > 448 |       expect(mockResponse.status).toHaveBeenCalledWith(422);\n          |                                   ^\n      449 |       expect(mockResponse.json).toHaveBeenCalledWith({\n      450 |         success: false,\n      451 |         message: 'Invalid or incomplete scraping data'\n\n      at Object.<anonymous> (tests/controllers/figureController.test.ts:448:35)\n\n  ● FigureController › searchFigures › should handle invalid search query formats\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      Object {\n    -   \"message\": \"Search query is too short or invalid\",\n    +   \"message\": \"Search query is required\",\n        \"success\": false,\n      },\n\n    Number of calls: 1\n\n      549 |\n      550 |       expect(mockResponse.status).toHaveBeenCalledWith(400);\n    > 551 |       expect(mockResponse.json).toHaveBeenCalledWith({\n          |                                 ^\n      552 |         success: false,\n      553 |         message: 'Search query is too short or invalid'\n      554 |       });\n\n      at Object.<anonymous> (tests/controllers/figureController.test.ts:551:33)\n\n  ● FigureController › searchFigures › should handle search with very long query\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 400\n    Received: 500\n\n    Number of calls: 1\n\n      560 |       await figureController.searchFigures(mockRequest as Request, mockResponse as Response);\n      561 |\n    > 562 |       expect(mockResponse.status).toHaveBeenCalledWith(400);\n          |                                   ^\n      563 |       expect(mockResponse.json).toHaveBeenCalledWith({\n      564 |         success: false,\n      565 |         message: 'Search query is too long'\n\n      at Object.<anonymous> (tests/controllers/figureController.test.ts:562:35)\n\n  ● FigureController › Local MFC Scraping Fallback Scenarios › should handle local fallback when scraper service fails completely\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 500\n    Received: 200\n\n    Number of calls: 1\n\n      767 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);\n      768 |\n    > 769 |       expect(mockResponse.status).toHaveBeenCalledWith(500);\n          |                                   ^\n      770 |       expect(mockResponse.json).toHaveBeenCalledWith(\n      771 |         expect.objectContaining({\n      772 |           success: false,\n\n      at Object.<anonymous> (tests/controllers/figureController.test.ts:769:35)\n\n  ● FigureController › Local MFC Scraping Fallback Scenarios › should handle Cloudflare challenge detection during scraping\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: 500\n    Received: 200\n\n    Number of calls: 1\n\n      797 |       await figureController.scrapeMFCData(mockRequest as Request, mockResponse as Response);\n      798 |\n    > 799 |       expect(mockResponse.status).toHaveBeenCalledWith(500);\n          |                                   ^\n      800 |       expect(mockResponse.json).toHaveBeenCalledWith(\n      801 |         expect.objectContaining({\n      802 |           success: false,\n\n      at Object.<anonymous> (tests/controllers/figureController.test.ts:799:35)\n\n  ● FigureController › Advanced Error Handling Scenarios › should handle complex scraping data merging scenarios\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: ObjectContaining {\"imageUrl\": \"https://example.com/detailed-image.jpg\", \"manufacturer\": \"Complete Manufacturer\", \"name\": \"Complete Name\", \"scale\": \"1/8\"}\n    Received: {\"boxNumber\": \"\", \"imageUrl\": \"https://example.com/detailed-image.jpg\", \"location\": \"\", \"manufacturer\": \"Partial Manufacturer\", \"mfcLink\": \"https://myfigurecollection.net/item/12345\", \"name\": \"Complete Name\", \"scale\": \"1/8\", \"userId\": \"000000000000000000000123\"}\n\n    Number of calls: 1\n\n      968 |       await figureController.createFigure(mockRequest as Request, mockResponse as Response);\n      969 |\n    > 970 |       expect(MockedFigure.create).toHaveBeenCalledWith(expect.objectContaining({\n          |                                   ^\n      971 |         manufacturer: 'Complete Manufacturer',\n      972 |         name: 'Complete Name',\n      973 |         scale: '1/8',\n\n      at Object.<anonymous> (tests/controllers/figureController.test.ts:970:35)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/figureController.test.ts","startTime":1756365917163,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":11,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"valid-token\", \"test-secret\"\nReceived: \"valid-token\", \"secret\"\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"valid-token\", \"test-secret\"\nReceived: \"valid-token\", \"secret\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/middleware/authMiddleware.test.ts:50:32)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"AuthMiddleware protect middleware should authenticate valid token and call next","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should authenticate valid token and call next"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":7,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  {\"id\": \"user123\"},\n- \"test-secret\",\n+ \"secret\",\n  {\"expiresIn\": \"60m\"},\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  {\"id\": \"user123\"},\n- \"test-secret\",\n+ \"secret\",\n  {\"expiresIn\": \"60m\"},\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/middleware/authMiddleware.test.ts:71:30)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"AuthMiddleware protect middleware should issue new token when current token is close to expiry","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should issue new token when current token is close to expiry"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware should not issue new token when current token has plenty of time left","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should not issue new token when current token has plenty of time left"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":75,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware should return 401 for invalid token","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should return 401 for invalid token"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware should return 401 for expired token","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should return 401 for expired token"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware should return 401 for missing authorization header","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should return 401 for missing authorization header"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware should return 401 for malformed authorization header","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should return 401 for malformed authorization header"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":6,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  Object {\n-   \"message\": \"Not authorized, no token\",\n+   \"message\": \"Not authorized, token failed\",\n    \"success\": false,\n  },\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  Object {\n-   \"message\": \"Not authorized, no token\",\n+   \"message\": \"Not authorized, token failed\",\n    \"success\": false,\n  },\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/middleware/authMiddleware.test.ts:175:33)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"AuthMiddleware protect middleware should return 401 for Bearer header without token","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"failed","title":"should return 401 for Bearer header without token"},{"ancestorTitles":["AuthMiddleware","protect middleware"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware should handle JWT verification errors gracefully","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle JWT verification errors gracefully"},{"ancestorTitles":["AuthMiddleware","protect middleware","Token refresh logic"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware Token refresh logic should calculate time until expiry correctly","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should calculate time until expiry correctly"},{"ancestorTitles":["AuthMiddleware","protect middleware","Token refresh logic"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware protect middleware Token refresh logic should not refresh token when more than 15 minutes remain","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should not refresh token when more than 15 minutes remain"},{"ancestorTitles":["AuthMiddleware","admin middleware"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware admin middleware should allow admin users to proceed","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should allow admin users to proceed"},{"ancestorTitles":["AuthMiddleware","admin middleware"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware admin middleware should deny non-admin users","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should deny non-admin users"},{"ancestorTitles":["AuthMiddleware","admin middleware"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware admin middleware should deny access if user not found","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should deny access if user not found"},{"ancestorTitles":["AuthMiddleware","admin middleware"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware admin middleware should handle database errors","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle database errors"},{"ancestorTitles":["AuthMiddleware","admin middleware"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware admin middleware should handle missing user in request","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"should handle missing user in request"},{"ancestorTitles":["AuthMiddleware","Middleware integration"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware Middleware integration should work with protect middleware followed by admin middleware","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should work with protect middleware followed by admin middleware"},{"ancestorTitles":["AuthMiddleware","Edge cases"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"AuthMiddleware Edge cases should handle token with missing exp field","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle token with missing exp field"},{"ancestorTitles":["AuthMiddleware","Edge cases"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", \"test-secret\"\nReceived: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", \"secret\"\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", \"test-secret\"\nReceived: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", \"secret\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/middleware/authMiddleware.test.ts:397:32)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"AuthMiddleware Edge cases should handle extremely long tokens","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle extremely long tokens"},{"ancestorTitles":["AuthMiddleware","Edge cases"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"token.with-special_chars+symbols=\", \"test-secret\"\nReceived: \"token.with-special_chars+symbols=\", \"secret\"\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"token.with-special_chars+symbols=\", \"test-secret\"\nReceived: \"token.with-special_chars+symbols=\", \"secret\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/middleware/authMiddleware.test.ts:416:32)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"AuthMiddleware Edge cases should handle special characters in tokens","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle special characters in tokens"}],"endTime":1756365918535,"message":"  ● AuthMiddleware › protect middleware › should authenticate valid token and call next\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"valid-token\", \"test-secret\"\n    Received: \"valid-token\", \"secret\"\n\n    Number of calls: 1\n\n      48 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);\n      49 |\n    > 50 |       expect(mockedJwt.verify).toHaveBeenCalledWith('valid-token', 'test-secret');\n         |                                ^\n      51 |       expect(mockRequest.user).toEqual({ id: 'user123' });\n      52 |       expect(mockNext).toHaveBeenCalled();\n      53 |       expect(mockResponse.status).not.toHaveBeenCalled();\n\n      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:50:32)\n\n  ● AuthMiddleware › protect middleware › should issue new token when current token is close to expiry\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      {\"id\": \"user123\"},\n    - \"test-secret\",\n    + \"secret\",\n      {\"expiresIn\": \"60m\"},\n\n    Number of calls: 1\n\n      69 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);\n      70 |\n    > 71 |       expect(mockedJwt.sign).toHaveBeenCalledWith(\n         |                              ^\n      72 |         { id: 'user123' },\n      73 |         'test-secret',\n      74 |         { expiresIn: '60m' }\n\n      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:71:30)\n\n  ● AuthMiddleware › protect middleware › should return 401 for Bearer header without token\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      Object {\n    -   \"message\": \"Not authorized, no token\",\n    +   \"message\": \"Not authorized, token failed\",\n        \"success\": false,\n      },\n\n    Number of calls: 1\n\n      173 |\n      174 |       expect(mockResponse.status).toHaveBeenCalledWith(401);\n    > 175 |       expect(mockResponse.json).toHaveBeenCalledWith({\n          |                                 ^\n      176 |         success: false,\n      177 |         message: 'Not authorized, no token'\n      178 |       });\n\n      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:175:33)\n\n  ● AuthMiddleware › Edge cases › should handle extremely long tokens\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", \"test-secret\"\n    Received: \"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa\", \"secret\"\n\n    Number of calls: 1\n\n      395 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);\n      396 |\n    > 397 |       expect(mockedJwt.verify).toHaveBeenCalledWith('a'.repeat(1000), 'test-secret');\n          |                                ^\n      398 |       expect(mockNext).toHaveBeenCalled();\n      399 |     });\n      400 |\n\n      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:397:32)\n\n  ● AuthMiddleware › Edge cases › should handle special characters in tokens\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"token.with-special_chars+symbols=\", \"test-secret\"\n    Received: \"token.with-special_chars+symbols=\", \"secret\"\n\n    Number of calls: 1\n\n      414 |       await protect(mockRequest as Request, mockResponse as Response, mockNext);\n      415 |\n    > 416 |       expect(mockedJwt.verify).toHaveBeenCalledWith('token.with-special_chars+symbols=', 'test-secret');\n          |                                ^\n      417 |       expect(mockNext).toHaveBeenCalled();\n      418 |     });\n      419 |   });\n\n      at Object.<anonymous> (tests/middleware/authMiddleware.test.ts:416:32)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/middleware/authMiddleware.test.ts","startTime":1756365917898,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Validation Middleware","validateRequest"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateRequest should pass validation for valid figure payload","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should pass validation for valid figure payload"},{"ancestorTitles":["Validation Middleware","validateRequest"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateRequest should fail validation for invalid figure payload","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should fail validation for invalid figure payload"},{"ancestorTitles":["Validation Middleware","validateRequest"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateRequest should reject unknown properties by default","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should reject unknown properties by default"},{"ancestorTitles":["Validation Middleware","validateContentType"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateContentType should pass when content type is allowed","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should pass when content type is allowed"},{"ancestorTitles":["Validation Middleware","validateContentType"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateContentType should reject when content type is not allowed","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should reject when content type is not allowed"},{"ancestorTitles":["Validation Middleware","validateContentType"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateContentType should reject when no content type is provided","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should reject when no content type is provided"},{"ancestorTitles":["Validation Middleware","validateObjectId"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateObjectId should pass for valid ObjectId","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should pass for valid ObjectId"},{"ancestorTitles":["Validation Middleware","validateObjectId"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateObjectId should reject when id is missing","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should reject when id is missing"},{"ancestorTitles":["Validation Middleware","validateObjectId"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware validateObjectId should reject invalid ObjectId","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should reject invalid ObjectId"},{"ancestorTitles":["Validation Middleware","globalErrorHandler"],"duration":12,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware globalErrorHandler should handle Mongoose CastError for invalid ObjectId","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle Mongoose CastError for invalid ObjectId"},{"ancestorTitles":["Validation Middleware","globalErrorHandler"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware globalErrorHandler should handle Mongoose ValidationError","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle Mongoose ValidationError"},{"ancestorTitles":["Validation Middleware","globalErrorHandler"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware globalErrorHandler should handle JSON parsing errors","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle JSON parsing errors"},{"ancestorTitles":["Validation Middleware","globalErrorHandler"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware globalErrorHandler should handle unhandled errors with 500 status","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle unhandled errors with 500 status"},{"ancestorTitles":["Validation Middleware","Validation Schemas","Figure Schema"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware Validation Schemas Figure Schema should validate figure with all optional fields","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should validate figure with all optional fields"},{"ancestorTitles":["Validation Middleware","Validation Schemas","Figure Schema"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware Validation Schemas Figure Schema should reject figure with invalid type","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should reject figure with invalid type"},{"ancestorTitles":["Validation Middleware","Validation Schemas","User Schema"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware Validation Schemas User Schema should validate strong password","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should validate strong password"},{"ancestorTitles":["Validation Middleware","Validation Schemas","User Schema"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(received).toBeDefined()\n\nReceived: undefined","pass":false}}],"failureMessages":["Error: expect(received).toBeDefined()\n\nReceived: undefined\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/middleware/validationMiddleware.test.ts:316:25\n    at Array.forEach (<anonymous>)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/middleware/validationMiddleware.test.ts:314:23)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Validation Middleware Validation Schemas User Schema should reject weak passwords","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"failed","title":"should reject weak passwords"},{"ancestorTitles":["Validation Middleware","Validation Schemas","User Schema"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware Validation Schemas User Schema should reject invalid email domains","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should reject invalid email domains"},{"ancestorTitles":["Validation Middleware","Validation Schemas","Pagination Schema"],"duration":1,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware Validation Schemas Pagination Schema should validate valid pagination parameters","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should validate valid pagination parameters"},{"ancestorTitles":["Validation Middleware","Validation Schemas","Pagination Schema"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware Validation Schemas Pagination Schema should set default values when not provided","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should set default values when not provided"},{"ancestorTitles":["Validation Middleware","Validation Schemas","Pagination Schema"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Validation Middleware Validation Schemas Pagination Schema should reject invalid pagination parameters","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should reject invalid pagination parameters"}],"endTime":1756365919125,"message":"  ● Validation Middleware › Validation Schemas › User Schema › should reject weak passwords\n\n    expect(received).toBeDefined()\n\n    Received: undefined\n\n      314 |         weakPasswords.forEach(userData => {\n      315 |           const { error } = user.validate(userData);\n    > 316 |           expect(error).toBeDefined();\n          |                         ^\n      317 |           expect(error?.details[0].path).toContain('password');\n      318 |         });\n      319 |       });\n\n      at tests/unit/middleware/validationMiddleware.test.ts:316:25\n          at Array.forEach (<anonymous>)\n      at Object.<anonymous> (tests/unit/middleware/validationMiddleware.test.ts:314:23)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/middleware/validationMiddleware.test.ts","startTime":1756365918538,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Atlas Search Mock Validation","Basic Search Functionality"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Basic Search Functionality should find exact matches by name","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should find exact matches by name"},{"ancestorTitles":["Atlas Search Mock Validation","Basic Search Functionality"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Basic Search Functionality should find matches by manufacturer","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should find matches by manufacturer"},{"ancestorTitles":["Atlas Search Mock Validation","Basic Search Functionality"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Basic Search Functionality should find matches by location","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should find matches by location"},{"ancestorTitles":["Atlas Search Mock Validation","Basic Search Functionality"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Basic Search Functionality should find matches by box number","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should find matches by box number"},{"ancestorTitles":["Atlas Search Mock Validation","Basic Search Functionality"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Basic Search Functionality should perform case-insensitive search","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should perform case-insensitive search"},{"ancestorTitles":["Atlas Search Mock Validation","Basic Search Functionality"],"duration":71,"failureDetails":[{"matcherResult":{"message":"expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []","pass":false}}],"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/atlasSearchMock.test.ts:164:23)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Atlas Search Mock Validation Basic Search Functionality should perform precise whole word matching","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should perform precise whole word matching"},{"ancestorTitles":["Atlas Search Mock Validation","Basic Search Functionality"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Basic Search Functionality should return empty array for no matches","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return empty array for no matches"},{"ancestorTitles":["Atlas Search Mock Validation","User Isolation"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation User Isolation should only return results for the specified user","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should only return results for the specified user"},{"ancestorTitles":["Atlas Search Mock Validation","User Isolation"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation User Isolation should not return results for other users","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should not return results for other users"},{"ancestorTitles":["Atlas Search Mock Validation","User Isolation"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation User Isolation should return results for the correct user","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return results for the correct user"},{"ancestorTitles":["Atlas Search Mock Validation","Response Format Validation"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []","pass":false}}],"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/atlasSearchMock.test.ts:205:23)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Atlas Search Mock Validation Response Format Validation should return correct response format","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should return correct response format"},{"ancestorTitles":["Atlas Search Mock Validation","Multi-field Search"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []","pass":false}}],"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/atlasSearchMock.test.ts:249:23)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Atlas Search Mock Validation Multi-field Search should search across all specified fields","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"failed","title":"should search across all specified fields"},{"ancestorTitles":["Atlas Search Mock Validation","Fuzzy Matching Simulation"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []","pass":false}}],"failureMessages":["Error: expect(received).toHaveLength(expected)\n\nExpected length: 1\nReceived length: 0\nReceived array:  []\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/atlasSearchMock.test.ts:258:23)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Atlas Search Mock Validation Fuzzy Matching Simulation should match with substring search","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should match with substring search"},{"ancestorTitles":["Atlas Search Mock Validation","Fuzzy Matching Simulation"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Fuzzy Matching Simulation should match with prefix search","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should match with prefix search"},{"ancestorTitles":["Atlas Search Mock Validation","Fuzzy Matching Simulation"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"Atlas Search Mock Validation Fuzzy Matching Simulation should require precise matching","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require precise matching"}],"endTime":1756365919663,"message":"  ● Atlas Search Mock Validation › Basic Search Functionality › should perform precise whole word matching\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      162 |       const results = testMockAtlasSearch('Rin', testDocuments, testUserId);\n      163 |       \n    > 164 |       expect(results).toHaveLength(1);\n          |                       ^\n      165 |       expect(results[0].name).toBe('Kagamine Rin');\n      166 |     });\n      167 |\n\n      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:164:23)\n\n  ● Atlas Search Mock Validation › Response Format Validation › should return correct response format\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      203 |       const results = testMockAtlasSearch('Miku', testDocuments, testUserId);\n      204 |       \n    > 205 |       expect(results).toHaveLength(1);\n          |                       ^\n      206 |       const result = results[0];\n      207 |       \n      208 |       // Check all required fields are present\n\n      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:205:23)\n\n  ● Atlas Search Mock Validation › Multi-field Search › should search across all specified fields\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      247 |       // Test that search looks in boxNumber field\n      248 |       results = testMockAtlasSearch('003', testDocuments, testUserId);\n    > 249 |       expect(results).toHaveLength(1);\n          |                       ^\n      250 |       expect(results[0].boxNumber).toBe('Box 003');\n      251 |     });\n      252 |   });\n\n      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:249:23)\n\n  ● Atlas Search Mock Validation › Fuzzy Matching Simulation › should match with substring search\n\n    expect(received).toHaveLength(expected)\n\n    Expected length: 1\n    Received length: 0\n    Received array:  []\n\n      256 |       const results = testMockAtlasSearch('Rin', testDocuments, testUserId);\n      257 |       \n    > 258 |       expect(results).toHaveLength(1);\n          |                       ^\n      259 |       expect(results[0].name).toBe('Kagamine Rin');\n      260 |     });\n      261 |\n\n      at Object.<anonymous> (tests/unit/atlasSearchMock.test.ts:258:23)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/unit/atlasSearchMock.test.ts","startTime":1756365919127,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["UserController","registerUser"],"duration":12,"failureDetails":[],"failureMessages":[],"fullName":"UserController registerUser should register a new user successfully","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should register a new user successfully"},{"ancestorTitles":["UserController","registerUser"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"UserController registerUser should return error if user already exists by email","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should return error if user already exists by email"},{"ancestorTitles":["UserController","registerUser"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"UserController registerUser should return error if user already exists by username","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error if user already exists by username"},{"ancestorTitles":["UserController","registerUser"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"UserController registerUser should handle server errors","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle server errors"},{"ancestorTitles":["UserController","registerUser"],"duration":85,"failureDetails":[],"failureMessages":[],"fullName":"UserController registerUser should handle missing required fields","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle missing required fields"},{"ancestorTitles":["UserController","loginUser"],"duration":4,"failureDetails":[],"failureMessages":[],"fullName":"UserController loginUser should login user successfully","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should login user successfully"},{"ancestorTitles":["UserController","loginUser"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"UserController loginUser should return error for non-existent user","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error for non-existent user"},{"ancestorTitles":["UserController","loginUser"],"duration":6,"failureDetails":[],"failureMessages":[],"fullName":"UserController loginUser should return error for incorrect password","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should return error for incorrect password"},{"ancestorTitles":["UserController","loginUser"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"UserController loginUser should handle server errors","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle server errors"},{"ancestorTitles":["UserController","getUserProfile"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"UserController getUserProfile should get user profile successfully","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should get user profile successfully"},{"ancestorTitles":["UserController","getUserProfile"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"UserController getUserProfile should return error if user not found","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error if user not found"},{"ancestorTitles":["UserController","getUserProfile"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"UserController getUserProfile should handle server errors","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle server errors"},{"ancestorTitles":["UserController","updateUserProfile"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"UserController updateUserProfile should update user profile successfully","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"should update user profile successfully"},{"ancestorTitles":["UserController","updateUserProfile"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"UserController updateUserProfile should update only provided fields","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should update only provided fields"},{"ancestorTitles":["UserController","updateUserProfile"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"UserController updateUserProfile should return error if user not found","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should return error if user not found"},{"ancestorTitles":["UserController","updateUserProfile"],"duration":2,"failureDetails":[],"failureMessages":[],"fullName":"UserController updateUserProfile should handle server errors","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle server errors"},{"ancestorTitles":["UserController","updateUserProfile"],"duration":7,"failureDetails":[],"failureMessages":[],"fullName":"UserController updateUserProfile should handle save errors","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle save errors"},{"ancestorTitles":["UserController","Token Generation"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  {\"id\": \"user123\"},\n- \"test-secret\",\n+ \"secret\",\n  {\"expiresIn\": \"60m\"},\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n- Expected\n+ Received\n\n  {\"id\": \"user123\"},\n- \"test-secret\",\n+ \"secret\",\n  {\"expiresIn\": \"60m\"},\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/userController.test.ts:435:30)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"UserController Token Generation should generate JWT token with correct payload","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should generate JWT token with correct payload"}],"endTime":1756365920345,"message":"  ● UserController › Token Generation › should generate JWT token with correct payload\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    - Expected\n    + Received\n\n      {\"id\": \"user123\"},\n    - \"test-secret\",\n    + \"secret\",\n      {\"expiresIn\": \"60m\"},\n\n    Number of calls: 1\n\n      433 |       await loginUser(mockRequest as Request, mockResponse as Response);\n      434 |\n    > 435 |       expect(mockedJwt.sign).toHaveBeenCalledWith(\n          |                              ^\n      436 |         { id: 'user123' },\n      437 |         'test-secret',\n      438 |         { expiresIn: '60m' }\n\n      at Object.<anonymous> (tests/controllers/userController.test.ts:435:30)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/controllers/userController.test.ts","startTime":1756365919665,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Database Configuration","connectDB"],"duration":12,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://localhost:27017/figure-collector\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://localhost:27017/figure-collector\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:44:38)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Database Configuration connectDB should connect to MongoDB successfully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should connect to MongoDB successfully"},{"ancestorTitles":["Database Configuration","connectDB"],"duration":6,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://custom-host:27017/custom-db\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://custom-host:27017/custom-db\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:61:38)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Database Configuration connectDB should use custom MongoDB URI from environment","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should use custom MongoDB URI from environment"},{"ancestorTitles":["Database Configuration","connectDB"],"duration":9,"failureDetails":[{}],"failureMessages":["Error: expect(received).toHaveBeenCalledTimes(expected)\n\nMatcher error: received value must be a mock or spy function\n\nReceived has type:  function\nReceived has value: [Function setTimeout]\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:82:26)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Configuration connectDB should retry connection on failure and eventually succeed","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should retry connection on failure and eventually succeed"},{"ancestorTitles":["Database Configuration","connectDB"],"duration":39,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined\n    at expect (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:109:13)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Configuration connectDB should exit process after maximum retries","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should exit process after maximum retries"},{"ancestorTitles":["Database Configuration","connectDB"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"MongoDB connection failed, retrying in 5000ms...\"\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"MongoDB connection failed, retrying in 5000ms...\"\n\nNumber of calls: 0\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:134:29)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Database Configuration connectDB should handle different types of connection errors","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle different types of connection errors"},{"ancestorTitles":["Database Configuration","connectDB"],"duration":9,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined\n    at expect (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:151:13)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Configuration connectDB should handle authentication errors","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle authentication errors"},{"ancestorTitles":["Database Configuration","Retry Logic"],"duration":35,"failureDetails":[{}],"failureMessages":["Error: expect(received).toHaveBeenCalledWith(...expected)\n\nMatcher error: received value must be a mock or spy function\n\nReceived has type:  function\nReceived has value: [Function setTimeout]\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:167:26)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Configuration Retry Logic should use correct retry delays","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should use correct retry delays"},{"ancestorTitles":["Database Configuration","Retry Logic"],"duration":3,"failureDetails":[{"message":"expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined"}],"failureMessages":["Error: expect(received).rejects.toThrow()\n\nReceived promise resolved instead of rejected\nResolved to value: undefined\n    at expect (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/expect/build/index.js:113:15)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:191:13)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:316:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:252:3)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Configuration Retry Logic should decrement retries correctly","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should decrement retries correctly"},{"ancestorTitles":["Database Configuration","Environment Configuration"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://localhost:27017/figure-collector\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://localhost:27017/figure-collector\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:210:38)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Database Configuration Environment Configuration should handle missing MONGODB_URI environment variable","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle missing MONGODB_URI environment variable"},{"ancestorTitles":["Database Configuration","Environment Configuration"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://localhost:27017/figure-collector\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"mongodb://localhost:27017/figure-collector\"\nReceived: \"mongodb://127.0.0.1:45975/\"\n\nNumber of calls: 1\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:228:38)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Database Configuration Environment Configuration should handle empty MONGODB_URI environment variable","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle empty MONGODB_URI environment variable"},{"ancestorTitles":["Database Configuration","Connection State"],"duration":2,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"MongoDB Connected: test-cluster.mongodb.net:27017\"\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"MongoDB Connected: test-cluster.mongodb.net:27017\"\n\nNumber of calls: 0\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:246:29)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Database Configuration Connection State should log correct host information","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should log correct host information"},{"ancestorTitles":["Database Configuration","Connection State"],"duration":3,"failureDetails":[{"matcherResult":{"message":"expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"MongoDB Connected: undefined\"\n\nNumber of calls: 0","pass":false}}],"failureMessages":["Error: expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\nExpected: \"MongoDB Connected: undefined\"\n\nNumber of calls: 0\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts:257:29)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)"],"fullName":"Database Configuration Connection State should handle undefined connection host","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle undefined connection host"}],"endTime":1756365920989,"message":"  ● Database Configuration › connectDB › should connect to MongoDB successfully\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"mongodb://localhost:27017/figure-collector\"\n    Received: \"mongodb://127.0.0.1:45975/\"\n\n    Number of calls: 1\n\n      42 |       await connectDB();\n      43 |\n    > 44 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(\n         |                                      ^\n      45 |         'mongodb://localhost:27017/figure-collector'\n      46 |       );\n      47 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: localhost:27017');\n\n      at Object.<anonymous> (tests/config/db.test.ts:44:38)\n\n  ● Database Configuration › connectDB › should use custom MongoDB URI from environment\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"mongodb://custom-host:27017/custom-db\"\n    Received: \"mongodb://127.0.0.1:45975/\"\n\n    Number of calls: 1\n\n      59 |       await connectDB();\n      60 |\n    > 61 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(\n         |                                      ^\n      62 |         'mongodb://custom-host:27017/custom-db'\n      63 |       );\n      64 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: custom-host:27017');\n\n      at Object.<anonymous> (tests/config/db.test.ts:61:38)\n\n  ● Database Configuration › connectDB › should retry connection on failure and eventually succeed\n\n    expect(received).toHaveBeenCalledTimes(expected)\n\n    Matcher error: received value must be a mock or spy function\n\n    Received has type:  function\n    Received has value: [Function setTimeout]\n\n      80 |\n      81 |       // Fast-forward first retry\n    > 82 |       expect(setTimeout).toHaveBeenCalledTimes(1);\n         |                          ^\n      83 |       jest.runOnlyPendingTimers();\n      84 |\n      85 |       // Fast-forward second retry\n\n      at Object.<anonymous> (tests/config/db.test.ts:82:26)\n\n  ● Database Configuration › connectDB › should exit process after maximum retries\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: undefined\n\n      107 |       }\n      108 |\n    > 109 |       await expect(connectPromise).rejects.toThrow('Process.exit called with code 1');\n          |             ^\n      110 |\n      111 |       expect(mockedMongoose.connect).toHaveBeenCalledTimes(6); // Initial + 5 retries\n      112 |       expect(consoleErrorSpy).toHaveBeenCalledWith(\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at Object.<anonymous> (tests/config/db.test.ts:109:13)\n\n  ● Database Configuration › connectDB › should handle different types of connection errors\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"MongoDB connection failed, retrying in 5000ms...\"\n\n    Number of calls: 0\n\n      132 |       await connectPromise;\n      133 |\n    > 134 |       expect(consoleLogSpy).toHaveBeenCalledWith(\n          |                             ^\n      135 |         'MongoDB connection failed, retrying in 5000ms...'\n      136 |       );\n      137 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: localhost:27017');\n\n      at Object.<anonymous> (tests/config/db.test.ts:134:29)\n\n  ● Database Configuration › connectDB › should handle authentication errors\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: undefined\n\n      149 |       }\n      150 |\n    > 151 |       await expect(connectPromise).rejects.toThrow('Process.exit called with code 1');\n          |             ^\n      152 |\n      153 |       expect(consoleErrorSpy).toHaveBeenCalledWith(\n      154 |         'MongoDB connection failed after multiple attempts',\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at Object.<anonymous> (tests/config/db.test.ts:151:13)\n\n  ● Database Configuration › Retry Logic › should use correct retry delays\n\n    expect(received).toHaveBeenCalledWith(...expected)\n\n    Matcher error: received value must be a mock or spy function\n\n    Received has type:  function\n    Received has value: [Function setTimeout]\n\n      165 |\n      166 |       // Check that setTimeout is called with correct delay\n    > 167 |       expect(setTimeout).toHaveBeenCalledWith(expect.any(Function), 5000);\n          |                          ^\n      168 |\n      169 |       jest.runOnlyPendingTimers();\n      170 |       expect(setTimeout).toHaveBeenCalledTimes(2);\n\n      at Object.<anonymous> (tests/config/db.test.ts:167:26)\n\n  ● Database Configuration › Retry Logic › should decrement retries correctly\n\n    expect(received).rejects.toThrow()\n\n    Received promise resolved instead of rejected\n    Resolved to value: undefined\n\n      189 |       }\n      190 |\n    > 191 |       await expect(connectPromise).rejects.toThrow('Process.exit called with code 1');\n          |             ^\n      192 |\n      193 |       // Should have attempted connection 6 times total (initial + 5 retries)\n      194 |       expect(mockedMongoose.connect).toHaveBeenCalledTimes(6);\n\n      at expect (node_modules/expect/build/index.js:113:15)\n      at Object.<anonymous> (tests/config/db.test.ts:191:13)\n\n  ● Database Configuration › Environment Configuration › should handle missing MONGODB_URI environment variable\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"mongodb://localhost:27017/figure-collector\"\n    Received: \"mongodb://127.0.0.1:45975/\"\n\n    Number of calls: 1\n\n      208 |       await connectDB();\n      209 |\n    > 210 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(\n          |                                      ^\n      211 |         'mongodb://localhost:27017/figure-collector'\n      212 |       );\n      213 |\n\n      at Object.<anonymous> (tests/config/db.test.ts:210:38)\n\n  ● Database Configuration › Environment Configuration › should handle empty MONGODB_URI environment variable\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"mongodb://localhost:27017/figure-collector\"\n    Received: \"mongodb://127.0.0.1:45975/\"\n\n    Number of calls: 1\n\n      226 |       await connectDB();\n      227 |\n    > 228 |       expect(mockedMongoose.connect).toHaveBeenCalledWith(\n          |                                      ^\n      229 |         'mongodb://localhost:27017/figure-collector'\n      230 |       );\n      231 |\n\n      at Object.<anonymous> (tests/config/db.test.ts:228:38)\n\n  ● Database Configuration › Connection State › should log correct host information\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"MongoDB Connected: test-cluster.mongodb.net:27017\"\n\n    Number of calls: 0\n\n      244 |       await connectDB();\n      245 |\n    > 246 |       expect(consoleLogSpy).toHaveBeenCalledWith(`MongoDB Connected: ${testHost}`);\n          |                             ^\n      247 |     });\n      248 |\n      249 |     it('should handle undefined connection host', async () => {\n\n      at Object.<anonymous> (tests/config/db.test.ts:246:29)\n\n  ● Database Configuration › Connection State › should handle undefined connection host\n\n    expect(jest.fn()).toHaveBeenCalledWith(...expected)\n\n    Expected: \"MongoDB Connected: undefined\"\n\n    Number of calls: 0\n\n      255 |       await connectDB();\n      256 |\n    > 257 |       expect(consoleLogSpy).toHaveBeenCalledWith('MongoDB Connected: undefined');\n          |                             ^\n      258 |     });\n      259 |   });\n      260 | });\n\n      at Object.<anonymous> (tests/config/db.test.ts:257:29)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/config/db.test.ts","startTime":1756365920347,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Database Connection Retry Logic"],"duration":17,"failureDetails":[],"failureMessages":[],"fullName":"Database Connection Retry Logic should successfully connect to MongoDB","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should successfully connect to MongoDB"},{"ancestorTitles":["Database Connection Retry Logic"],"duration":1,"failureDetails":[{}],"failureMessages":["MongoNotConnectedError: Client must be connected before running operations\n    at executeOperationAsync (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:30\n    at maybeCallback (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/utils.ts:373:19)\n    at executeOperation (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n    at Collection.deleteMany (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/collection.ts:439:28)\n    at NativeCollection.<computed> [as deleteMany] (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/testSetup.ts:50:22)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Connection Retry Logic should retry connection multiple times before failing","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should retry connection multiple times before failing"},{"ancestorTitles":["Database Connection Retry Logic"],"duration":1,"failureDetails":[{}],"failureMessages":["MongoNotConnectedError: Client must be connected before running operations\n    at executeOperationAsync (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:30\n    at maybeCallback (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/utils.ts:373:19)\n    at executeOperation (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n    at Collection.deleteMany (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/collection.ts:439:28)\n    at NativeCollection.<computed> [as deleteMany] (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/testSetup.ts:50:22)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Connection Retry Logic should exit process after maximum retry attempts","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should exit process after maximum retry attempts"},{"ancestorTitles":["Database Connection Retry Logic"],"duration":1,"failureDetails":[{}],"failureMessages":["MongoNotConnectedError: Client must be connected before running operations\n    at executeOperationAsync (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:30\n    at maybeCallback (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/utils.ts:373:19)\n    at executeOperation (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n    at Collection.deleteMany (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/collection.ts:439:28)\n    at NativeCollection.<computed> [as deleteMany] (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/testSetup.ts:50:22)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Connection Retry Logic should handle invalid MongoDB URI gracefully","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should handle invalid MongoDB URI gracefully"},{"ancestorTitles":["Database Connection Retry Logic"],"duration":0,"failureDetails":[{}],"failureMessages":["MongoNotConnectedError: Client must be connected before running operations\n    at executeOperationAsync (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n    at /home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:30\n    at maybeCallback (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/utils.ts:373:19)\n    at executeOperation (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n    at Collection.deleteMany (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongodb/src/collection.ts:439:28)\n    at NativeCollection.<computed> [as deleteMany] (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n    at Object.<anonymous> (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/testSetup.ts:50:22)\n    at Promise.then.completed (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:298:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/utils.js:231:10)\n    at _callCircusHook (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:281:40)\n    at _runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:246:5)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:126:9)\n    at _runTestsForDescribeBlock (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:121:9)\n    at run (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/run.js:71:3)\n    at runAndTransformResultsToJestFormat (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)\n    at jestAdapter (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)\n    at runTestInternal (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:367:16)\n    at runTest (/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/node_modules/jest-runner/build/runTest.js:444:34)"],"fullName":"Database Connection Retry Logic should log connection host on successful connection","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"failed","title":"should log connection host on successful connection"}],"endTime":1756365921427,"message":"  ● Database Connection Retry Logic › should retry connection multiple times before failing\n\n    MongoNotConnectedError: Client must be connected before running operations\n\n      48 |   for (const key in collections) {\n      49 |     const collection = collections[key];\n    > 50 |     await collection.deleteMany({});\n         |                      ^\n      51 |   }\n      52 | });\n      53 |\n\n      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n      at node_modules/mongodb/src/operations/execute_operation.ts:79:30\n      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)\n      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)\n      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n      at Object.<anonymous> (tests/testSetup.ts:50:22)\n\n  ● Database Connection Retry Logic › should exit process after maximum retry attempts\n\n    MongoNotConnectedError: Client must be connected before running operations\n\n      48 |   for (const key in collections) {\n      49 |     const collection = collections[key];\n    > 50 |     await collection.deleteMany({});\n         |                      ^\n      51 |   }\n      52 | });\n      53 |\n\n      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n      at node_modules/mongodb/src/operations/execute_operation.ts:79:30\n      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)\n      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)\n      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n      at Object.<anonymous> (tests/testSetup.ts:50:22)\n\n  ● Database Connection Retry Logic › should handle invalid MongoDB URI gracefully\n\n    MongoNotConnectedError: Client must be connected before running operations\n\n      48 |   for (const key in collections) {\n      49 |     const collection = collections[key];\n    > 50 |     await collection.deleteMany({});\n         |                      ^\n      51 |   }\n      52 | });\n      53 |\n\n      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n      at node_modules/mongodb/src/operations/execute_operation.ts:79:30\n      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)\n      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)\n      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n      at Object.<anonymous> (tests/testSetup.ts:50:22)\n\n  ● Database Connection Retry Logic › should log connection host on successful connection\n\n    MongoNotConnectedError: Client must be connected before running operations\n\n      48 |   for (const key in collections) {\n      49 |     const collection = collections[key];\n    > 50 |     await collection.deleteMany({});\n         |                      ^\n      51 |   }\n      52 | });\n      53 |\n\n      at executeOperationAsync (node_modules/mongodb/src/operations/execute_operation.ts:94:13)\n      at node_modules/mongodb/src/operations/execute_operation.ts:79:30\n      at maybeCallback (node_modules/mongodb/src/utils.ts:373:19)\n      at executeOperation (node_modules/mongodb/src/operations/execute_operation.ts:79:23)\n      at Collection.deleteMany (node_modules/mongodb/src/collection.ts:439:28)\n      at NativeCollection.<computed> [as deleteMany] (node_modules/mongoose/lib/drivers/node-mongodb-native/collection.js:243:33)\n      at Object.<anonymous> (tests/testSetup.ts:50:22)\n","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/database/dbConnection.test.ts","startTime":1756365920991,"status":"failed","summary":""},{"assertionResults":[{"ancestorTitles":["Figure Model","Schema Validation"],"duration":75,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Schema Validation should create a valid figure with required fields","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"should create a valid figure with required fields"},{"ancestorTitles":["Figure Model","Schema Validation"],"duration":133,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Schema Validation should require manufacturer field","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require manufacturer field"},{"ancestorTitles":["Figure Model","Schema Validation"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Schema Validation should require name field","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require name field"},{"ancestorTitles":["Figure Model","Schema Validation"],"duration":50,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Schema Validation should require userId field","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require userId field"},{"ancestorTitles":["Figure Model","Schema Validation"],"duration":52,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Schema Validation should accept all optional fields","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should accept all optional fields"},{"ancestorTitles":["Figure Model","Schema Validation"],"duration":53,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Schema Validation should handle empty string values for optional fields","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should handle empty string values for optional fields"},{"ancestorTitles":["Figure Model","User Reference"],"duration":62,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model User Reference should properly reference a user","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should properly reference a user"},{"ancestorTitles":["Figure Model","User Reference"],"duration":51,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model User Reference should fail with invalid userId","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should fail with invalid userId"},{"ancestorTitles":["Figure Model","Indexes"],"duration":57,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Indexes should have indexes on manufacturer and name","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should have indexes on manufacturer and name"},{"ancestorTitles":["Figure Model","Indexes"],"duration":58,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Indexes should support compound index queries","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should support compound index queries"},{"ancestorTitles":["Figure Model","Timestamps"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Timestamps should automatically set createdAt and updatedAt","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should automatically set createdAt and updatedAt"},{"ancestorTitles":["Figure Model","Timestamps"],"duration":65,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Timestamps should update updatedAt on save","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should update updatedAt on save"},{"ancestorTitles":["Figure Model","Data Types and Edge Cases"],"duration":52,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Data Types and Edge Cases should handle long strings","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle long strings"},{"ancestorTitles":["Figure Model","Data Types and Edge Cases"],"duration":51,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Data Types and Edge Cases should handle special characters","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should handle special characters"},{"ancestorTitles":["Figure Model","Data Types and Edge Cases"],"duration":51,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Data Types and Edge Cases should handle URL formats in mfcLink and imageUrl","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle URL formats in mfcLink and imageUrl"},{"ancestorTitles":["Figure Model","Query Operations"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Query Operations should find figures by manufacturer","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should find figures by manufacturer"},{"ancestorTitles":["Figure Model","Query Operations"],"duration":57,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Query Operations should find figures by scale","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should find figures by scale"},{"ancestorTitles":["Figure Model","Query Operations"],"duration":54,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Query Operations should find figures by location","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should find figures by location"},{"ancestorTitles":["Figure Model","Query Operations"],"duration":54,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Query Operations should support regex queries","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should support regex queries"},{"ancestorTitles":["Figure Model","Query Operations"],"duration":55,"failureDetails":[],"failureMessages":[],"fullName":"Figure Model Query Operations should support sorting","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should support sorting"}],"endTime":1756365923060,"message":"","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/models/Figure.test.ts","startTime":1756365921429,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["User Model","Schema Validation"],"duration":73,"failureDetails":[],"failureMessages":[],"fullName":"User Model Schema Validation should create a valid user with required fields","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"passed","title":"should create a valid user with required fields"},{"ancestorTitles":["User Model","Schema Validation"],"duration":100,"failureDetails":[],"failureMessages":[],"fullName":"User Model Schema Validation should require username field","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require username field"},{"ancestorTitles":["User Model","Schema Validation"],"duration":11,"failureDetails":[],"failureMessages":[],"fullName":"User Model Schema Validation should require email field","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require email field"},{"ancestorTitles":["User Model","Schema Validation"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"User Model Schema Validation should require password field","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should require password field"},{"ancestorTitles":["User Model","Schema Validation"],"duration":100,"failureDetails":[],"failureMessages":[],"fullName":"User Model Schema Validation should enforce unique username","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should enforce unique username"},{"ancestorTitles":["User Model","Schema Validation"],"duration":97,"failureDetails":[],"failureMessages":[],"fullName":"User Model Schema Validation should enforce unique email","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should enforce unique email"},{"ancestorTitles":["User Model","Password Hashing"],"duration":51,"failureDetails":[],"failureMessages":[],"fullName":"User Model Password Hashing should hash password before saving","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should hash password before saving"},{"ancestorTitles":["User Model","Password Hashing"],"duration":54,"failureDetails":[],"failureMessages":[],"fullName":"User Model Password Hashing should not hash password if not modified","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should not hash password if not modified"},{"ancestorTitles":["User Model","Password Hashing"],"duration":98,"failureDetails":[],"failureMessages":[],"fullName":"User Model Password Hashing should rehash password if modified","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should rehash password if modified"},{"ancestorTitles":["User Model","comparePassword Method"],"duration":100,"failureDetails":[],"failureMessages":[],"fullName":"User Model comparePassword Method should return true for correct password","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return true for correct password"},{"ancestorTitles":["User Model","comparePassword Method"],"duration":95,"failureDetails":[],"failureMessages":[],"fullName":"User Model comparePassword Method should return false for incorrect password","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return false for incorrect password"},{"ancestorTitles":["User Model","comparePassword Method"],"duration":94,"failureDetails":[],"failureMessages":[],"fullName":"User Model comparePassword Method should return false for empty password","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should return false for empty password"},{"ancestorTitles":["User Model","comparePassword Method"],"duration":144,"failureDetails":[],"failureMessages":[],"fullName":"User Model comparePassword Method should handle special characters in password","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should handle special characters in password"},{"ancestorTitles":["User Model","Default Values"],"duration":50,"failureDetails":[],"failureMessages":[],"fullName":"User Model Default Values should set isAdmin to false by default","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should set isAdmin to false by default"},{"ancestorTitles":["User Model","Default Values"],"duration":50,"failureDetails":[],"failureMessages":[],"fullName":"User Model Default Values should allow setting isAdmin to true","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should allow setting isAdmin to true"},{"ancestorTitles":["User Model","Timestamps"],"duration":49,"failureDetails":[],"failureMessages":[],"fullName":"User Model Timestamps should automatically set createdAt and updatedAt","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should automatically set createdAt and updatedAt"},{"ancestorTitles":["User Model","Timestamps"],"duration":63,"failureDetails":[],"failureMessages":[],"fullName":"User Model Timestamps should update updatedAt on save","invocations":1,"location":null,"numPassingAsserts":1,"retryReasons":[],"status":"passed","title":"should update updatedAt on save"}],"endTime":1756365924703,"message":"","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/models/User.test.ts","startTime":1756365923062,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Database Integration Tests","Connection Management"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Connection Management should handle connection states properly","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle connection states properly"},{"ancestorTitles":["Database Integration Tests","Connection Management"],"duration":150,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Connection Management should handle database operations when connected","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle database operations when connected"},{"ancestorTitles":["Database Integration Tests","Collection Operations"],"duration":62,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Collection Operations should handle bulk operations on User collection","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should handle bulk operations on User collection"},{"ancestorTitles":["Database Integration Tests","Collection Operations"],"duration":60,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Collection Operations should handle bulk operations on Figure collection","invocations":1,"location":null,"numPassingAsserts":7,"retryReasons":[],"status":"passed","title":"should handle bulk operations on Figure collection"},{"ancestorTitles":["Database Integration Tests","Index Performance Tests"],"duration":17,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Index Performance Tests should utilize indexes for User queries","invocations":1,"location":null,"numPassingAsserts":4,"retryReasons":[],"status":"passed","title":"should utilize indexes for User queries"},{"ancestorTitles":["Database Integration Tests","Index Performance Tests"],"duration":74,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Index Performance Tests should utilize compound indexes for Figure queries","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should utilize compound indexes for Figure queries"},{"ancestorTitles":["Database Integration Tests","Transaction Support"],"duration":56,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Transaction Support should handle transactions when supported","invocations":1,"location":null,"numPassingAsserts":0,"retryReasons":[],"status":"passed","title":"should handle transactions when supported"},{"ancestorTitles":["Database Integration Tests","Transaction Support"],"duration":61,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Transaction Support should handle failed transactions properly","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should handle failed transactions properly"},{"ancestorTitles":["Database Integration Tests","Data Integrity Tests"],"duration":152,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Data Integrity Tests should enforce unique constraints","invocations":1,"location":null,"numPassingAsserts":2,"retryReasons":[],"status":"passed","title":"should enforce unique constraints"},{"ancestorTitles":["Database Integration Tests","Data Integrity Tests"],"duration":8,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Data Integrity Tests should enforce required fields","invocations":1,"location":null,"numPassingAsserts":6,"retryReasons":[],"status":"passed","title":"should enforce required fields"},{"ancestorTitles":["Database Integration Tests","Data Integrity Tests"],"duration":68,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Data Integrity Tests should handle foreign key relationships","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should handle foreign key relationships"},{"ancestorTitles":["Database Integration Tests","Performance Tests"],"duration":102,"failureDetails":[],"failureMessages":[],"fullName":"Database Integration Tests Performance Tests should handle large dataset queries efficiently","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should handle large dataset queries efficiently"}],"endTime":1756365925968,"message":"","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/database.test.ts","startTime":1756365924705,"status":"passed","summary":""},{"assertionResults":[{"ancestorTitles":["Inter-Service Communication","Backend → Scraper Service Communication"],"duration":10,"failureDetails":[],"failureMessages":[],"fullName":"Inter-Service Communication Backend → Scraper Service Communication should successfully call scraper service for MFC data","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should successfully call scraper service for MFC data"},{"ancestorTitles":["Inter-Service Communication","Backend → Version Service Communication"],"duration":3,"failureDetails":[],"failureMessages":[],"fullName":"Inter-Service Communication Backend → Version Service Communication should fetch app version from Version Service","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should fetch app version from Version Service"},{"ancestorTitles":["Inter-Service Communication","Backend → Version Service Communication"],"duration":5,"failureDetails":[],"failureMessages":[],"fullName":"Inter-Service Communication Backend → Version Service Communication should validate version combinations via Version Service","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should validate version combinations via Version Service"},{"ancestorTitles":["Inter-Service Communication","Backend Service Registration and Version Aggregation"],"duration":31,"failureDetails":[],"failureMessages":[],"fullName":"Inter-Service Communication Backend Service Registration and Version Aggregation should register frontend service successfully","invocations":1,"location":null,"numPassingAsserts":3,"retryReasons":[],"status":"passed","title":"should register frontend service successfully"},{"ancestorTitles":["Inter-Service Communication","Backend Service Registration and Version Aggregation"],"duration":96,"failureDetails":[],"failureMessages":[],"fullName":"Inter-Service Communication Backend Service Registration and Version Aggregation should aggregate service versions","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should aggregate service versions"},{"ancestorTitles":["Inter-Service Communication","Complete Workflow Integration"],"duration":17,"failureDetails":[],"failureMessages":[],"fullName":"Inter-Service Communication Complete Workflow Integration should perform end-to-end figure creation with version validation","invocations":1,"location":null,"numPassingAsserts":5,"retryReasons":[],"status":"passed","title":"should perform end-to-end figure creation with version validation"}],"endTime":1756365926689,"message":"","name":"/home/rgoldberg/projects/figure-collector-services/figure-collector-backend/tests/integration/inter-service/interServiceCommunication.test.ts","startTime":1756365925970,"status":"passed","summary":""}],"wasInterrupted":false}

Jest has detected the following 1 open handle potentially keeping Jest from exiting:

  ●  TCPSERVERWRAP

      180 |
      181 | // Start the server
    > 182 | app.listen(PORT, () => {
          |     ^
      183 |   console.log(`Server running on port ${PORT}`);
      184 | });
      185 |

      at app.listen (node_modules/express/lib/application.js:635:24)
      at Object.<anonymous> (src/index.ts:182:5)
      at Object.<anonymous> (tests/integration/routes/figureRoutes.test.ts:2:1)

